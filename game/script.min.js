console.log("(\uff62\u0e51\u2579\u11ba\u2579)\uff62\uff7f\uff83\uff9e\uff78\uff9a\uff5e");window.focus();enchant();
window.onload=function(){function A(a,b){null==b&&(b=1);a=a.clone();a.play();a.volume=w/3*b}function I(){var a=enchant.Core.instance;a.scale=Math.min(window.innerWidth/384,window.innerHeight/512);var b=(window.innerHeight-a.height*a.scale)/2,c=(window.innerWidth-a.width*a.scale)/2,d=document.getElementById("enchant-stage");d.style.position="absolute";d.style.top=b+"px";d.style.left=c+"px";a._pageX=c;a._pageY=b}var y=UI_FONT_FAM,e=[["resources/scale/F3_16.mp3","resources/scale/F3_8.mp3","resources/scale/F3_4.mp3",
"resources/scale/F3_2.mp3","resources/scale/F3_1.mp3"],["resources/scale/G3_16.mp3","resources/scale/G3_8.mp3","resources/scale/G3_4.mp3","resources/scale/G3_2.mp3","resources/scale/G3_1.mp3"],["resources/scale/A3_16.mp3","resources/scale/A3_8.mp3","resources/scale/A3_4.mp3","resources/scale/A3_2.mp3","resources/scale/A3_1.mp3"],["resources/scale/B3_16.mp3","resources/scale/B3_8.mp3","resources/scale/B3_4.mp3","resources/scale/B3_2.mp3","resources/scale/B3_1.mp3"],["resources/scale/C4_16.mp3","resources/scale/C4_8.mp3",
"resources/scale/C4_4.mp3","resources/scale/C4_2.mp3","resources/scale/C4_1.mp3"],["resources/scale/D4_16.mp3","resources/scale/D4_8.mp3","resources/scale/D4_4.mp3","resources/scale/D4_2.mp3","resources/scale/D4_1.mp3"],["resources/scale/E4_16.mp3","resources/scale/E4_8.mp3","resources/scale/E4_4.mp3","resources/scale/E4_2.mp3","resources/scale/E4_1.mp3"],["resources/scale/F4_16.mp3","resources/scale/F4_8.mp3","resources/scale/F4_4.mp3","resources/scale/F4_2.mp3","resources/scale/F4_1.mp3"],["resources/scale/G4_16.mp3",
"resources/scale/G4_8.mp3","resources/scale/G4_4.mp3","resources/scale/G4_2.mp3","resources/scale/G4_1.mp3"],["resources/scale/A4_16.mp3","resources/scale/A4_8.mp3","resources/scale/A4_4.mp3","resources/scale/A4_2.mp3","resources/scale/A4_1.mp3"],["resources/scale/B4_16.mp3","resources/scale/B4_8.mp3","resources/scale/B4_4.mp3","resources/scale/B4_2.mp3","resources/scale/B4_1.mp3"],["resources/scale/C5_16.mp3","resources/scale/C5_8.mp3","resources/scale/C5_4.mp3","resources/scale/C5_2.mp3","resources/scale/C5_1.mp3"],
["resources/scale/D5_16.mp3","resources/scale/D5_8.mp3","resources/scale/D5_4.mp3","resources/scale/D5_2.mp3","resources/scale/D5_1.mp3"],["resources/scale/E5_16.mp3","resources/scale/E5_8.mp3","resources/scale/E5_4.mp3","resources/scale/E5_2.mp3","resources/scale/E5_1.mp3"],["resources/scale/F5_16.mp3","resources/scale/F5_8.mp3","resources/scale/F5_4.mp3","resources/scale/F5_2.mp3","resources/scale/F5_1.mp3"],["resources/scale/G5_16.mp3","resources/scale/G5_8.mp3","resources/scale/G5_4.mp3","resources/scale/G5_2.mp3",
"resources/scale/G5_1.mp3"]],l=[["resources/scale/F3s_16.mp3","resources/scale/F3s_8.mp3","resources/scale/F3s_4.mp3","resources/scale/F3s_2.mp3","resources/scale/F3s_1.mp3"],["resources/scale/G3s_16.mp3","resources/scale/G3s_8.mp3","resources/scale/G3s_4.mp3","resources/scale/G3s_2.mp3","resources/scale/G3s_1.mp3"],["resources/scale/A3s_16.mp3","resources/scale/A3s_8.mp3","resources/scale/A3s_4.mp3","resources/scale/A3s_2.mp3","resources/scale/A3s_1.mp3"],["resources/scale/B3s_16.mp3","resources/scale/B3s_8.mp3",
"resources/scale/B3s_4.mp3","resources/scale/B3s_2.mp3","resources/scale/B3s_1.mp3"],["resources/scale/C4s_16.mp3","resources/scale/C4s_8.mp3","resources/scale/C4s_4.mp3","resources/scale/C4s_2.mp3","resources/scale/C4s_1.mp3"],["resources/scale/D4s_16.mp3","resources/scale/D4s_8.mp3","resources/scale/D4s_4.mp3","resources/scale/D4s_2.mp3","resources/scale/D4s_1.mp3"],["resources/scale/E4s_16.mp3","resources/scale/E4s_8.mp3","resources/scale/E4s_4.mp3","resources/scale/E4s_2.mp3","resources/scale/E4s_1.mp3"],
["resources/scale/F4s_16.mp3","resources/scale/F4s_8.mp3","resources/scale/F4s_4.mp3","resources/scale/F4s_2.mp3","resources/scale/F4s_1.mp3"],["resources/scale/G4s_16.mp3","resources/scale/G4s_8.mp3","resources/scale/G4s_4.mp3","resources/scale/G4s_2.mp3","resources/scale/G4s_1.mp3"],["resources/scale/A4s_16.mp3","resources/scale/A4s_8.mp3","resources/scale/A4s_4.mp3","resources/scale/A4s_2.mp3","resources/scale/A4s_1.mp3"],["resources/scale/B4s_16.mp3","resources/scale/B4s_8.mp3","resources/scale/B4s_4.mp3",
"resources/scale/B4s_2.mp3","resources/scale/B4s_1.mp3"],["resources/scale/C5s_16.mp3","resources/scale/C5s_8.mp3","resources/scale/C5s_4.mp3","resources/scale/C5s_2.mp3","resources/scale/C5s_1.mp3"],["resources/scale/D5s_16.mp3","resources/scale/D5s_8.mp3","resources/scale/D5s_4.mp3","resources/scale/D5s_2.mp3","resources/scale/D5s_1.mp3"],["resources/scale/E5s_16.mp3","resources/scale/E5s_8.mp3","resources/scale/E5s_4.mp3","resources/scale/E5s_2.mp3","resources/scale/E5s_1.mp3"],["resources/scale/F5s_16.mp3",
"resources/scale/F5s_8.mp3","resources/scale/F5s_4.mp3","resources/scale/F5s_2.mp3","resources/scale/F5s_1.mp3"],["resources/scale/G5s_16.mp3","resources/scale/G5s_8.mp3","resources/scale/G5s_4.mp3","resources/scale/G5s_2.mp3","resources/scale/G5s_1.mp3"]],U={G7:[e[8][4],e[10][4],e[12][4],e[14][4]],CM7:[e[4][4],e[6][4],e[8][4],e[10][4]],Em7:[e[6][4],e[8][4],e[10][4],e[12][4]],FM7:[e[7][4],e[9][4],e[11][4],e[13][4]],Dadd9:[e[5][4],e[6][4],l[7][4],e[9][4]],E:[e[6][4],l[8][4],e[10][4]],"F#m7":[l[7][4],
e[9][4],l[11][4],e[13][4]],A:[e[9][4],l[11][4],e[13][4]],BbM7:[l[9][4],e[12][4],e[14][4]],"-BbM7":[l[2][4],e[5][4],e[7][4],e[9][4]],C:[e[4][4],e[6][4],e[8][4]],Am7:[e[9][4],e[11][4],e[13][4],e[15][4]],Dm7:[e[5][4],e[7][4],e[9][4],e[11][4]],Gm7:[e[8][4],l[9][4],e[12][4],e[14][4]],Bdim:[e[10][4],e[12][4],e[14][4]],F:[e[7][4],e[9][4],e[11][4]],Adim:[e[9][4],e[11][4],l[12][4]],Ebdim:[l[5][4],l[7][4],e[9][4]],"Em7(-5)":[e[6][4],e[8][4],l[9][4],e[12][4]]},J=["resources/note16.png","resources/note8.png",
"resources/note4.png","resources/note2.png","resources/note1.png"],f=new Game(384,512),w=2;f.fps=20;f.rootScene.backgroundColor="#74c7f4";f.preload(["resources/\u3061\u3087\u3063\u3068\u3057\u305f\u3089\u6674\u308c.mp3","resources/puyon1.mp3","resources/\u304d\u3089\u304d\u3089\u8f1d\u304f.wav"]);e.forEach(function(a){f.preload(a)});l.forEach(function(a){f.preload(a)});J.forEach(function(a){f.preload(a)});f.preload(["resources/notesymbol_sharp.png","resources/notesymbol_flat.png"]);f.preload(["resources/title.png"]);
f.preload(["resources/bg_pattern1_aozora.jpg","resources/bg_heaven.jpg","resources/G_clef.png","resources/yokoari.png","resources/give_up.png"]);f.preload("resources/item.png resources/seedling.png resources/moyashi.png resources/oyster.png resources/horror.png resources/onigiri.png resources/kemomimi_onigiri.png resources/pig_hana.png resources/ankimo_item.png".split(" "));f.preload(["resources/block.png","resources/barricade.png"]);f.preload(["resources/sorachan.png","resources/Achan.png","resources/ankimo.png",
"resources/soratomo.png"]);f.preload(["resources/star_effect.png","resources/heart_effect.png","resources/explode.png","resources/isse-no-de.png","resources/kamifubuki.png"]);f.preload(["resources/mame.png"]);f.preload(["resources/fullscreen.png","resources/volume.png","resources/Achan_icon.png","resources/sorach_balloon.png"]);STAGES.forEach(function(a){a.card&&f.preload("https://i.ytimg.com/vi/"+a.card.id+"/default.jpg")});PICK_UP_CARDS_ON_CLEAR.forEach(function(a){f.preload("https://i.ytimg.com/vi/"+
a.id+"/default.jpg")});PICK_UP_CARDS_ON_GAMEOVER.forEach(function(a){f.preload("https://i.ytimg.com/vi/"+a.id+"/default.jpg")});var M=Class.create(Scene,{initialize:function(){Scene.call(this);var a=f.assets["resources/\u3061\u3087\u3063\u3068\u3057\u305f\u3089\u6674\u308c.mp3"].clone();a.play();a.volume=w/3*.25;new ButtonVanishBugFix(this);var b=new Sprite(384,512);b.image=f.assets["resources/bg_pattern1_aozora.jpg"];b.moveTo(0,0);this.addChild(b);b=new Sprite(320,128);b.image=f.assets["resources/title.png"];
b.moveTo((384-b.width)/2,25.6);this.addChild(b);for(var c=Class.create(Button2,{initialize:function(a){Button2.call(this,a.name,384*.8,51.2);this.stage_obj=a},ontouchend:function(b){a.stop();f.replaceScene(new K(this.stage_obj))}}),d=0;d<STAGES.length;d++){var e=new c(STAGES[d]);e.moveTo((384-e.width)/2,b.y+25.6+b.height+d*(e.height+5));this.addChild(e)}c=new Sprite(32,32);c.image=f.assets["resources/fullscreen.png"];c.moveTo(b.x,512-1.5*c.height);c.on("touchend",function(a){document.fullScreenElement&&
null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():
document.webkitCancelFullScreen&&document.webkitCancelFullScreen()});this.addChild(c);b=new Sprite(64,32);b.image=f.assets["resources/volume.png"];b.moveTo(c.x+c.width+5,c.y);b.on("touchend",function(b){w++;3<w&&(w=0);this._update();a.volume=w/3*.25});b._update=function(){this.frame=w};b._update();this.addChild(b);b=new Sprite(64,64);b.image=f.assets["resources/sorachan.png"];b.frame=0;b.scale(-1,1);b.moveTo(384-b.width-10,512-b.height-10);b.on("touchend",function(a){window.open("https://t.co/YVd92xsmZA")});
c=new Sprite(64,42);c.image=f.assets["resources/sorach_balloon.png"];c.moveTo(b.x-c.width,b.y+(b.height-c.height)/2);c.on("touchend",function(a){window.open("https://t.co/YVd92xsmZA")});this.addChild(b);this.addChild(c)}}),K=Class.create(Scene,{initialize:function(a){Scene.call(this);this.stage_obj=a;this.backgroundColor="white";var b=this,c=new Sprite(384,512);c.image=f.assets["resources/bg_pattern1_aozora.jpg"];c.moveTo(0,0);this.addChild(c);this.bg=c;c=new Sprite(384,512);c.moveTo(0,0);var d=new Surface(c.width,
c.height);d.context.fillStyle="rgba(0, 0, 128, 0.25)";for(var e=-2;2>=e;e++){var V=-c.y+512-16-32*(10+2*e);d.context.beginPath();d.context.fillRect(0,V-1,384,3)}d.draw(f.assets["resources/G_clef.png"],0,-10.24,96,409.6);c.image=d;this.addChild(c);c=new m(a.name,a.map,a.bpm);c.moveTo(0,0);this.addChild(c);this.stage=c;d=new W(c.speed,k.min_jump_vy(60.8));d.moveTo((384-d.width)/2,(512-d.height)/2);c.insertBefore(d,c.soraLayer);d.setInitPosition();this.soraChan=d;this.autoPlayer=new X(d,a.code);var q=
new Label("");q.font="bold 16px "+y;q.color="red";q.textAlign="left";q.moveTo(0,0);q.on("enterframe",function(){q.text=10>f.actualFps?" LOW FPS!!":""});this.addChild(q);var g=new Label(" ");g.font="bold 32px "+y;g.color="lightcyan";g.textAlign="center";g.borderWidth=4;g.borderColor="skyblue";g.moveTo((384-g.width)/2,3);g.on("enterframe",function(){g.text="\u266a"+b.soraChan.sounded_soundGate_count+"/"+b.soraChan.passed_soundGate_count});this.addChild(g);c=new Group;d=new Sprite(32,32);d.image=f.assets["resources/Achan_icon.png"];
d.moveTo(0,0);c.addChild(d);var t=new Label("x0  ");t.font="bold 20px "+y;t.color="lightcyan";t.textAlign="left";t.borderWidth=4;t.borderColor="skyblue";t.moveTo(d.x+d.width,d.y+(d.height-t._boundHeight)/2);t.on("enterframe",function(){t.text="x"+n.collection.length;t.color=b.amax_mode?"yellow":"lightcyan"});c.addChild(t);c.moveTo(384*.7,8);this.addChild(c);c=new Sprite(32,32);c.image=f.assets["resources/give_up.png"];c.moveTo(10,512-c.height-10);c.on("touchend",function(a){b.stage.state=m.STATE.GAMEOVER});
this.addChild(c);this.result_showing=this.amax_mode=!1;this.soraSongMovieCard=a.card||null},ontouchend:function(a){this.soraChan.jump();for(a=0;a<n.collection.length;a++)n.collection[a].jump()},onenterframe:function(){switch(this.stage.state){case m.STATE.PLAYING:this.stage.updatePosition();this.soraChan.updatePosition();n.collection.forEach(function(a){a.updatePosition()});B.collection.forEach(function(a){a.updatePosition()});this.autoPlayer.update();if(32*this.stage.goal_gridx<=this.soraChan.x+
this.soraChan.width)this.stage.state=m.STATE.CLEAR;else if(0>=this.soraChan.getHP())this.stage.state=m.STATE.GAMEOVER;else if(!this.amax_mode&&100<=n.collection.length){A(f.assets["resources/\u304d\u3089\u304d\u3089\u8f1d\u304f.wav"],.2);this.amax_mode=!0;for(var a=0;a<n.collection.length;a++)n.collection[a].id=a;this.bg.image=f.assets["resources/bg_heaven.jpg"]}else this.amax_mode&&90>n.collection.length&&(this.amax_mode=!1,this.bg.image=f.assets["resources/bg_pattern1_aozora.jpg"]);if(f.input.up)this.ontouchend();
f.input.left&&this._replay();f.input.down&&(this.stage.state=m.STATE.GAMEOVER);break;default:case m.STATE.GAMEOVER:this.result_showing||this._onResult();f.input.left&&this._replay();break;case m.STATE.CLEAR:this.result_showing?this.soraChan.sounded_soundGate_count==this.soraChan.passed_soundGate_count&&0==this.age%2&&this.addChild(new Y):this._onResult(),f.input.left&&this._replay()}},_replay:function(){f.replaceScene(new K(this.stage_obj))},_onResult:function(){var a="",b="",c="",d="",e=null;switch(this.stage.state){case m.STATE.CLEAR:a=
"CLEAR!!";b="black";c="white";d="rgba(255,255,255,0.75)";e=this.soraSongMovieCard;break;default:a="(\u0e51>\u11ba<)\ud83d\udca6",b="white",c="gray",d="rgba(75,75,75,0.75)",e=this.soraSongMovieCard}new ButtonVanishBugFix(this);var g=this,q=new Entity;q.width=384;q.height=512;q.backgroundColor=d;this.addChild(q);a=new Label(a);a.font="bold 30px "+y;a.color=b;a.borderWidth=4;a.borderColor=c;a.moveTo((384-a._boundWidth)/2,512/3);this.addChild(a);c=new Button2("\u3082\u3046\u3044\u3061\u3069",384*.6,512/
15);c.moveTo((384-c.width)/2,256);c.on("touchend",function(a){g._replay()});this.addChild(c);b=new Button2("\u30c4\u30a4\u30fc\u30c8\u3059\u308b",384*.6,512/15);b.moveTo((384-b.width)/2,c.y+c.height+5);b.on("touchend",function(a){g._tweet()});this.addChild(b);c=new Button2("\u30bf\u30a4\u30c8\u30eb\u306b\u3082\u3069\u308b",384*.6,512/15);c.moveTo((384-c.width)/2,b.y+b.height+5);c.on("touchend",function(a){f.replaceScene(new M)});this.addChild(c);e&&(e=new Z(e),e.moveTo((384-e.width)/2,512-e.height-
25.6),this.addChild(e));this.result_showing=!0},_tweet:function(){var a="\u307b\u3063\u3077\u3059\u3066\u3063\u3077\u3068\u304d\u306e\u305d\u3089\uff01\uff5e\u79cb\u306e\u3048\u30fc\u8c46\u53ce\u7a6b\u796d\uff5e\n"+("\u66f2\u76ee\uff1a\u300e"+this.stage.name+"\u300f\n");switch(this.stage.state){case m.STATE.CLEAR:var b=this.soraChan.sounded_soundGate_count,c=this.soraChan.passed_soundGate_count;a+="\u7d50\u679c\uff1a\u266a"+b+"/"+c+" ("+Math.floor(100*b/c)+"%)\u3067\u30af\u30ea\u30a2\uff01\uff01";
a+=this.amax_mode?"\u305d\u3057\u3066\u3048\u30fc\u307e\u3063\u304f\u3059\uff01\uff01":"";a=b==c?a+"\u30ab\u30f3\u30da\u30ad\u3067\u3059\u30fc\uff01\uff01\uff01\n":0==b?a+"\u306a\uff5e\u3093\u3067\u306a\u3093\u3060\u3044\u3063\uff01\uff01\n":a+"\n";break;case m.STATE.GAMEOVER:a+="\u7d50\u679c\uff1a(\u0e51>\u11ba<)\ud83d\udca6\n"}window.open("https://twitter.com/intent/tweet?text="+encodeURI(a)+"&hashtags=\u3068\u304d\u306e\u305d\u3089&url="+encodeURI("https://likeslug.github.io/hopsteptokinosora/game"))}}),
m=Class.create(Group,{initialize:function(a,b,c){Group.call(this);this.name=a;this.speed=c/60*128/20;this.state=m.STATE.PLAYING;this.pattern=b;this.bgLayer=new Node;this.addChild(this.bgLayer);this.blockLayer=new Node;this.addChild(this.blockLayer);this.achanLayer=new Node;this.addChild(this.achanLayer);this.effectLayer=new Node;this.addChild(this.effectLayer);this.bulletLayer=new Node;this.addChild(this.bulletLayer);this.ankimoLayer=new Node;this.addChild(this.ankimoLayer);this.soraLayer=new Node;
this.addChild(this.soraLayer);this.itemLayer=new Node;this.addChild(this.itemLayer);for(a=1;a<b.length;a++)console.assert(b[a].length==b[a-1].length,"stage-map widths are unmatch! (row"+a+":"+b[a].length+" != row"+(a-1)+":"+b[a-1].length+")");c=12;var d=0;for(a=0;a<b.length;a++){d<b[a].length&&(d=b[a].length);for(var e=0;e<b[a].length;e++)0===b[b.length-a-1][e]&&c<e&&(c=e)}this.goal_gridx=c;this.gridwidth=d;this.block_drawn_gridx=0},_updateDrawStageObjects:function(){for(var a=Math.max(0,Math.floor((-this.x+
1152)/32)),b=this.pattern,c=this.block_drawn_gridx;c<a;){for(var d=0;d<b.length;d++){var e=b.length-d-1;if(!(c>=b[e].length))switch(b[e][c]){case 0:this.insertBefore(new aa(c,d),this.itemLayer);break;case 1:this.insertBefore(new N(c,d),this.blockLayer);break;case 2:this.insertBefore(new ba(c,d),this.blockLayer);break;case 10:this.insertBefore(new g(f.assets["resources/item.png"],c,d),this.itemLayer);break;case 11:this.insertBefore(new O(c,d),this.itemLayer);break;case 12:this.insertBefore(new P(c,
d),this.itemLayer);break;case 13:this.insertBefore(new Q(c,d),this.itemLayer);break;case 14:this.insertBefore(new R(c,d),this.itemLayer);break;case 15:this.insertBefore(new C(c,d),this.itemLayer);break;case 16:this.insertBefore(new E(c,d),this.itemLayer);break;case 17:this.insertBefore(new F(c,d),this.effectLayer);break;case 50:this.insertBefore(new ca(c,d),this.effectLayer);break;case 70:this.insertBefore(new h(d,0,c,d,-1),this.itemLayer);break;case 71:this.insertBefore(new h(d,1,c,d,-1),this.itemLayer);
break;case 72:this.insertBefore(new h(d,2,c,d,-1),this.itemLayer);break;case 73:this.insertBefore(new h(d,3,c,d,-1),this.itemLayer);break;case 74:this.insertBefore(new h(d,4,c,d,-1),this.itemLayer);break;case 80:this.insertBefore(new h(d,0,c,d,0),this.itemLayer);break;case 81:this.insertBefore(new h(d,1,c,d,0),this.itemLayer);break;case 82:this.insertBefore(new h(d,2,c,d,0),this.itemLayer);break;case 83:this.insertBefore(new h(d,3,c,d,0),this.itemLayer);break;case 84:this.insertBefore(new h(d,4,c,
d,0),this.itemLayer);break;case 90:this.insertBefore(new h(d,0,c,d,1),this.itemLayer);break;case 91:this.insertBefore(new h(d,1,c,d,1),this.itemLayer);break;case 92:this.insertBefore(new h(d,2,c,d,1),this.itemLayer);break;case 93:this.insertBefore(new h(d,3,c,d,1),this.itemLayer);break;case 94:this.insertBefore(new h(d,4,c,d,1),this.itemLayer)}}c++}this.block_drawn_gridx=c;x.collection.forEach(function(a){-800>a.globalX()&&a.parentNode.removeChild(a)})},updatePosition:function(){this.moveBy(-this.speed,
0);this._updateDrawStageObjects()}});m.STATE={PLAYING:0,CLEAR:1,GAMEOVER:2};var u=Class.create(Sprite,{initialize:function(a,b,c){Sprite.call(this,b,c);this.image=a},hitTest:function(a,b){this.intersect(a).forEach(function(a){b(a)})},globalX:function(){return this.x+this.parentNode.x}}),k=Class.create(u,{initialize:function(a,b,c,d,e){u.call(this,a,32*b,32*c);this.state=k.STATE.JUMPING;this.vx=d;this.vy=0;this.jump_vy=-e},jump:function(){this.state=k.STATE.JUMPING;this.vy=this.jump_vy},_updateWorldForce:function(){16<
this.vy&&(this.vy=16);this.moveBy(this.vx,this.vy);this.vy+=1.2},_updateBlockForce:function(a){this.state=k.STATE.JUMPING;var b=this,c=this.y,d=this.y+this.height/4,e=this.y+3*this.height/4,f=this.y+this.height,g=this.x+this.width/2,h=this.x+this.width;a.collection.forEach(function(a){var L=a.globalX();-96<=L+a.width&&384>L&&(a.isIn(g,f)?(b.y=a.y-b.height,b.vy=0,b.state=k.STATE.WALKING,b.onTouchBlock(a,p.SIDE.TOP)):a.isIn(g,c)&&0>b.vy&&(b.y=a.y+a.height,b.vy=0,b.onTouchBlock(a,p.SIDE.BOTTOM)),(a.isIn(h,
d)||a.isIn(h,e))&&0<=b.vx&&(b.x=a.x-b.width,b.onTouchBlock(a,p.SIDE.LEFT)))})},onTouchBlock:function(a,b){},updatePosition:function(){this._updateWorldForce();this._updateBlockForce(p)}});k.STATE={WALKING:1,JUMPING:2};k.min_jump_vy=function(a){return Math.sqrt(2.4*a)};var W=Class.create(k,{initialize:function(a,b){k.call(this,f.assets["resources/sorachan.png"],2,2,a,b);this.super=k.prototype;this.init_global_x=0;this.wakinigiri_mode=!1;this.sounded_soundGate_count=this.passed_soundGate_count=0},setInitPosition:function(){this.init_global_x=
this.globalX()},getHP:function(){return 512<this.y?0:(this.globalX()+this.width)/(this.init_global_x+this.width)},onenterframe:function(){var a=[0,1,0,2],b=[3,4];switch(this.state){default:this.frame=a[Math.floor(2*this.x/32)%a.length];break;case k.STATE.JUMPING:this.frame=b[Math.floor(this.age/4)%b.length]}},updatePosition:function(){var a=this;this.super.updatePosition.call(this);v.collection.forEach(function(a){a.updatePosition()});this._soundGateHitTest();this.hitTest(O,function(b){b.onGet();
var c=n.collection.length;0>=c&&(c=1);100<2*c&&(c=100-c);for(var d=0;d<c;d++)n.yield(a);b.parentNode.removeChild(b)});this.hitTest(Q,function(b){b.onGet();a._joinSoratomo();b.parentNode.removeChild(b)});this.hitTest(C,function(a){a.parentNode.removeChild(a)});this.hitTest(P,function(b){b.onGet();if(!B.collection.length){var c=new B(a.vx);c.moveTo(-a.parentNode.x+384-32-c.width,b.y);a.parentNode.insertBefore(c,a.parentNode.ankimoLayer)}b.parentNode.removeChild(b)});this.hitTest(R,function(b){b.onGet();
a.wakinigiri_mode=!0;b.parentNode.removeChild(b)});this.wakinigiri_mode&&0==this.age%10&&this.parentNode.insertBefore(new z(this),this.parentNode.ankimoLayer)},_joinSoratomo:function(){this.parentNode.insertBefore(new v(this),this)},_soundGateHitTest:function(){for(var a,b=this.x+this.width/2,c=0,d=h.collection.length;c<d;c++)if(a=h.collection[c],null!=a){var e=a.x+a.width/2;!a.passed&&b>e&&(a.passed=!0,this.passed_soundGate_count++,this.y<a.y+a.height&&this.y+this.height>a.y||v.yHit(a)||z.yHit(a))&&
(a.onHit(this),this.parentNode.insertBefore(v.collection.length?this.scene.amax_mode?new da(e,a.y+a.height/2):new G(e,a.y+a.height/2):this.scene.amax_mode?new ea(e,a.y+a.height/2):new H(e,a.y+a.height/2),this.parentNode.effectLayer),this.sounded_soundGate_count++)}}}),n=Class.create(k,{initialize:function(a,b,c){k.call(this,f.assets["resources/Achan.png"],2,2,a,b);this.super=k.prototype;this.jump_vy_base=b;this.sora=c;this.id=-1},jump:function(){this.jump_vy=128>=this.y+this.height?0:-(this.jump_vy_base+
20*(Math.random()-.5));this.super.jump.call(this)},_wreck:function(){this.frame=[0,1,1,2,2,1,1,0,null]},onTouchBlock:function(a,b){a.breakable&&b==p.SIDE.LEFT&&(this._wreck(),this.parentNode.insertBefore(new D(a.x+a.width/2,a.y+a.height/2),this.parentNode.effectLayer),a.parentNode.removeChild(a))},updatePosition:function(){var a=!1,b=this;if(0>this.id||0==n.collection.length){if(this.super.updatePosition.call(this),0>this.globalX()+this.width||512<this.y)a=!0}else{for(var c=0,d=32,e=0;4>e;e++){var f=
100*(3-e)/4;if(this.id>=f){c=2*(e%2?-1:1)*Math.PI*((this.id-f)/25+this.sora.age/60);d=48*(e+1);break}}this.moveBy(.2*(this.sora.x+(this.sora.width-this.width)/2+d*Math.cos(c)-this.x),.2*(this.sora.y+(this.sora.height-this.height)/2+d*Math.sin(c)-this.y));this.super._updateBlockForce.call(this,p)}this.hitTest(C,function(c){b.parentNode.insertBefore(new S(b),b.parentNode.effectLayer);a=!0;c.parentNode.removeChild(c)});this.hitTest(E,function(c){b.parentNode.insertBefore(new S(b),b.parentNode.effectLayer);
a=!0;c.parentNode.removeChild(c)});this.hitTest(F,function(c){b.parentNode.insertBefore(new fa(b),b.parentNode.effectLayer);a=!0});a&&this.parentNode.removeChild(this)}});n.yield=function(a){var b=new n(a.vx,-a.jump_vy,a);b.moveTo(a.x+(384-a.globalX()-b.width-32)*Math.random(),0);a.parentNode.insertBefore(b,a.parentNode.achanLayer);return b};var B=Class.create(k,{initialize:function(a){k.call(this,f.assets["resources/ankimo.png"],2,2,a,k.min_jump_vy(32));this.super=k.prototype},onTouchBlock:function(a,
b){b==p.SIDE.LEFT&&this.jump()},updatePosition:function(){var a=!1;this.super.updatePosition.call(this);0==this.age%10&&this.parentNode.insertBefore(new ha(this),this.parentNode.bulletLayer);480<this.y&&(a=!0);a&&this.parentNode.removeChild(this)}}),v=Class.create(u,{initialize:function(a){u.call(this,f.assets["resources/soratomo.png"],64,64);var b=v.collection.length;this.sora=a;this.offset_y=b%2?a.height+(b-1)/2*this.height:-this.height*(b/2+1)},updatePosition:function(){this.moveTo(this.sora.x,
this.sora.y+this.offset_y)}});v.yHit=function(a){for(var b,c=0;c<v.collection.length;c++)if(b=v.collection[c],b.y<=a.y+a.height&&b.y+b.height>=a.y)return!0;return!1};var z=Class.create(k,{initialize:function(a){k.call(this,f.assets["resources/onigiri.png"],1,1,a.vx,-a.jump_vy);this.moveTo(a.x+(a.width-this.width)/2,a.y);this.master=a;this.vy=0},onTouchBlock:function(a,b){b==p.SIDE.TOP&&(this.jump(),this.jump_vy/=2)},updatePosition:function(){this._updateWorldForce();this._updateBlockForce(N);this.moveTo(this.master.x+
(this.master.width-this.width)/2+5,this.y)},onenterframe:function(){this.updatePosition();(this.globalX()<-this.width-64||512<this.y||-1<this.jump_vy)&&this.parentNode.removeChild(this)}});z.yHit=function(a){for(var b,c=0;c<z.collection.length;c++)if(b=z.collection[c],b.y<=a.y+a.height&&b.y+b.height>=a.y)return!0;return!1};var x=Class.create(u,{initialize:function(a,b,c,d,e){u.call(this,a,32*d,32*e);this.moveTo(32*b,512-32*(c+1))},isIn:function(a,b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&
b<=this.y+this.height}}),aa=Class.create(x,{initialize:function(a,b){x.call(this,f.assets["resources/yokoari.png"],a,b,4,2);this.moveTo(32*(a+.5)-this.width/2,512-32*b-this.height)}}),p=Class.create(x,{initialize:function(a,b,c){x.call(this,a,b,c,1,1);this.breakable=!1}});p.SIDE={TOP:0,BOTTOM:1,RIGHT:2,LEFT:3};var N=Class.create(p,{initialize:function(a,b){p.call(this,f.assets["resources/block.png"],a,b,1,1);.05>Math.random()&&(this.frame=1)}}),ba=Class.create(p,{initialize:function(a,b){p.call(this,
f.assets["resources/barricade.png"],a,b,1,1);this.breakable=!0}}),g=Class.create(x,{initialize:function(a,b,c,d,e){x.call(this,a,b,c,d,e)},onGet:function(){A(f.assets["resources/puyon1.mp3"],.05)}}),h=Class.create(g,{initialize:function(a,b,c,d,k){k=void 0===k?0:k;g.call(this,f.assets[J[b]],c,d+1,1,2);d=c=null;switch(k){case -1:c=f.assets[l[a-1][b]];d=f.assets["resources/notesymbol_flat.png"];break;default:case 0:c=f.assets[e[a][b]];break;case 1:c=f.assets[l[a][b]],d=f.assets["resources/notesymbol_sharp.png"]}this.sound=
c;this.passed=!1;if(d){var h=new Sprite(32,32);h.image=d;h.moveTo(this.x-h.width/2,this.y+(this.height-3*h.height/2));this.on("addedtoscene",function(){this.parentNode.insertBefore(h,this.parentNode.itemLayer)});this.on("removedfromscene",function(){h.parentNode.removeChild(h)})}},onHit:function(a){A(this.sound,.2);this.parentNode.removeChild(this)},onGet:function(){}}),O=Class.create(g,{initialize:function(a,b){g.call(this,f.assets["resources/seedling.png"],a,b,1,1)}}),Q=Class.create(g,{initialize:function(a,
b){g.call(this,f.assets["resources/pig_hana.png"],a,b,1,1)}}),P=Class.create(g,{initialize:function(a,b){g.call(this,f.assets["resources/ankimo_item.png"],a,b,2,1)},onenterframe:function(){this.visible=0==B.collection.length}}),R=Class.create(g,{initialize:function(a,b){g.call(this,f.assets["resources/kemomimi_onigiri.png"],a,b,1,1)}}),C=Class.create(g,{initialize:function(a,b){g.call(this,f.assets["resources/moyashi.png"],a,b,1,1);this.originX=this.width/2;this.originY=this.height/2;this.rotation=
b%4*90}}),E=Class.create(g,{initialize:function(a,b){g.call(this,f.assets["resources/oyster.png"],a,b,1,1)}}),F=Class.create(g,{initialize:function(a,b){g.call(this,f.assets["resources/horror.png"],a,b,2,2)}}),r=Class.create(u,{initialize:function(a,b,c){u.call(this,a,b,c)}}),S=Class.create(r,{initialize:function(a){r.call(this,f.assets["resources/Achan.png"],64,64);this.frame=3;this.moveTo(a.x,a.y)},onenterframe:function(){this.x-=2;0>this.globalX()+this.width&&this.parentNode.removeChild(this)}}),
fa=Class.create(r,{initialize:function(a){r.call(this,f.assets["resources/Achan.png"],64,64);this.frame=4;this.moveTo(a.x,a.y)},onenterframe:function(){this.x-=10;0>this.globalX()+this.width&&this.parentNode.removeChild(this)}}),H=Class.create(r,{initialize:function(a,b){r.call(this,f.assets["resources/star_effect.png"],128,128);this.originX=this.width/2;this.originY=this.height/2;this.moveTo(a-this.width/2,b-this.height/2)},onenterframe:function(){this.scaleX+=.1;this.scaleY+=.1;this.rotation+=10;
this.opacity-=.1;0>=this.opacity&&this.parentNode.removeChild(this)}}),ea=Class.create(H,{initialize:function(a,b){H.call(this,a,b)},onenterframe:function(){this.scaleX+=.2;this.scaleY+=.2;this.rotation+=10;this.opacity-=.05;0>=this.opacity&&this.parentNode.removeChild(this)}}),G=Class.create(r,{initialize:function(a,b){r.call(this,f.assets["resources/heart_effect.png"],128,128);this.originX=this.width/2;this.originY=this.height/2;this.moveTo(a-this.width/2,b-this.height/2)},onenterframe:function(){this.scaleX+=
.2;this.scaleY+=.2;this.opacity-=.1;0>=this.opacity&&this.parentNode.removeChild(this)}}),da=Class.create(G,{initialize:function(a,b){G.call(this,a,b)},onenterframe:function(){this.scaleX+=.3;this.scaleY+=.3;this.opacity-=.05;0>=this.opacity&&this.parentNode.removeChild(this)}}),ca=Class.create(r,{initialize:function(a,b){r.call(this,f.assets["resources/isse-no-de.png"],256,32);this.moveTo(32*a,512-32*(b+1))}}),D=Class.create(r,{initialize:function(a,b){r.call(this,f.assets["resources/explode.png"],
64,64);this.originX=this.width/2;this.originY=this.height/2;this.moveTo(a-this.width/2,b-this.height/2);this.scale(.5,.5)},onenterframe:function(){this.scaleX+=.2;this.scaleY+=.2;this.opacity-=.2;0>=this.opacity&&this.parentNode.removeChild(this)}}),T=Class.create(u,{initialize:function(a,b){u.call(this,a,32,32);this.moveTo(b.x+(b.width-this.width)/2,b.y+(b.height-this.height)/2)},onenterframe:function(){}}),ha=Class.create(T,{initialize:function(a){T.call(this,f.assets["resources/mame.png"],a);this.vx=
a.vx+32*(2*Math.random()-1)/5;this.vy=-k.min_jump_vy(512*(Math.random()+1)/2)},onenterframe:function(){16<this.vy&&(this.vy=16);this.moveBy(this.vx,this.vy);this.vy+=1.2;this.hitTest(C,function(a){a.parentNode.insertBefore(new D(a.x+a.width/2,a.y+a.height/2),a.parentNode.effectLayer);a.parentNode.removeChild(a)});this.hitTest(E,function(a){a.parentNode.insertBefore(new D(a.x+a.width/2,a.y+a.height/2),a.parentNode.effectLayer);a.parentNode.removeChild(a)});this.hitTest(F,function(a){a.parentNode.insertBefore(new D(a.x+
a.width/2,a.y+a.height/2),a.parentNode.effectLayer);a.parentNode.removeChild(a)});512<this.y&&this.parentNode.removeChild(this)}}),Z=Class.create(Group,{initialize:function(a){Group.call(this);this.width=384*.8;this.height=100;var b=new Entity;b.width=384*.8;b.height=100;b.backgroundColor="#FFF8";this.addChild(b);var c=new Sprite(120,90);c.image=f.assets["https://i.ytimg.com/vi/"+a.id+"/default.jpg"];c.moveTo(10,(b.height-c.height)/2);this.addChild(c);var d=new Label(a.caption);d.width=b.width-c.width-
30;d.height=c.height/2;d.font="16px "+y;d.moveTo(c.x+c.width+10,c.y);this.addChild(d);b=new Label(a.title);b.width=d.width;b.font="10px "+y;b.moveTo(c.x+c.width+10,d.y+d.height);this.addChild(b);this.on("touchend",function(b){window.open("https://www.youtube.com/watch?v="+a.id+(a.sec?"#t="+Math.floor(a.sec/60)+"m"+a.sec%60+"s":""))})}}),X=Class.create({initialize:function(a,b){this.sora=a;this.code=b;this.done_idx=0},update:function(){var a=this.code;if(a){var b=this.sora;b=Math.floor((b.x+(b.width-
32)/2)/32);if(a[b]&&b>this.done_idx){var c=U[a[b]];c?c.forEach(function(a){A(f.assets[a],.1)}):console.log("undefined code : "+a[b]);this.done_idx=b}}}}),Y=Class.create(Sprite,{initialize:function(){Sprite.call(this,16,16);this.image=f.assets["resources/kamifubuki.png"];this.frame=Math.floor(5*Math.random());this.originX=this.width/2;this.originY=this.height/2;this.scaleX=this.scaleY=.5*(1+Math.random());this.moveTo((384-this.width)*Math.random(),-this.height)},onenterframe:function(){this.rotation+=
5;this.scaleX=Math.sin(this.age);this.moveBy(0,10*this.scaleY);512<this.y&&this.parentNode.removeChild(this)}});window.onresize=function(){I()};I();f.onload=function(){var a=new M;f.pushScene(a)};f.start()};
