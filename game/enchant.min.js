/* enchant.js v0.8.3 http://enchantjs.com Copyright (c) UEI Corporation Released Under the MIT license. */ 
/* ui.enchant.js v2 (2012/11/05) http://enchantjs.com Copyright (c) UEI Corporation Released Under the MIT license. */ 
(function(k,n){"function"!==typeof Object.defineProperty&&(Object.defineProperty=function(a,b,d){"value"in d&&(a[b]=d.value);"get"in d&&a.__defineGetter__(b,d.get);"set"in d&&a.__defineSetter__(b,d.set);return a});"function"!==typeof Object.defineProperties&&(Object.defineProperties=function(a,b){for(var d in b)b.hasOwnProperty(d)&&Object.defineProperty(a,d,b[d]);return a});"function"!==typeof Object.create&&(Object.create=function(a,b){function d(){}d.prototype=a;a=new d;null!=b&&Object.defineProperties(a,
b);return a});"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(a){return a.__proto__});"function"!==typeof Function.prototype.bind&&(Function.prototype.bind=function(a){var b=this,d=Array.prototype.slice.call(arguments,1),c=function(){},f=function(){var e=d.concat(Array.prototype.slice.call(arguments));return b.apply(this instanceof c?this:a||k,e)};c.prototype=b.prototype;f.prototype=new c;return f});k.getTime=function(){if(k.performance&&k.performance.now){var a=Date.now();
return function(){return a+k.performance.now()}}return k.performance&&k.performance.webkitNow?(a=Date.now(),function(){return a+k.performance.webkitNow()}):Date.now}();k.requestAnimationFrame=k.requestAnimationFrame||k.mozRequestAnimationFrame||k.webkitRequestAnimationFrame||k.msRequestAnimationFrame||function(){var a=k.getTime(),b=1E3/60;return function(d){return setTimeout(function(){a=k.getTime();d(a)},Math.max(0,a+b-k.getTime()))}}();var c=function(a){null!=a&&(a instanceof Array||(a=Array.prototype.slice.call(arguments)),
a=a.filter(function(a){return[a].join()}));(function f(d,c){var e=[],h;for(h in d)if(d.hasOwnProperty(h))if("function"===typeof d[h])k[h]=d[h];else if("object"===typeof d[h]&&null!==d[h]&&Object.getPrototypeOf(d[h])===Object.prototype)if(null==a)e.push(h);else{var m=a.indexOf(c+h);-1!==m&&(e.push(h),a.splice(m,1))}m=0;for(h=e.length;m<h;m++)f(d[e[m]],c+e[m]+".")})(c,"");c.Class.getInheritanceTree(k.Game).length<=c.Class.getInheritanceTree(k.Core).length&&(k.Game=k.Core);if(null!=a&&a.length)throw Error("Cannot load module: "+
a.join(", "));};k.enchant=c;k.addEventListener("message",function(a,b){try{var d=JSON.parse(a.data);if("event"===d.type)c.Core.instance.dispatchEvent(new c.Event(d.value));else if("debug"===d.type)switch(d.value){case "start":c.Core.instance.start();break;case "pause":c.Core.instance.pause();break;case "resume":c.Core.instance.resume();break;case "tick":c.Core.instance._tick()}}catch(e){}},!1);c.Class=function(a,b){return c.Class.create(a,b)};c.Class.create=function(a,b){if(null==a&&b)throw Error("superclass is undefined (enchant.Class.create)");
if(null==a)throw Error("definition is undefined (enchant.Class.create)");if(0===arguments.length)return c.Class.create(Object,b);if(1===arguments.length&&"function"!==typeof arguments[0])return c.Class.create(Object,arguments[0]);for(var d in b)b.hasOwnProperty(d)&&("object"===typeof b[d]&&null!==b[d]&&Object.getPrototypeOf(b[d])===Object.prototype?"enumerable"in b[d]||(b[d].enumerable=!0):b[d]={value:b[d],enumerable:!0,writable:!0});var e=function(){if(this instanceof e)e.prototype.initialize.apply(this,
arguments);else return new e};e.prototype=Object.create(a.prototype,b);e.prototype.constructor=e;null==e.prototype.initialize&&(e.prototype.initialize=function(){a.apply(this,arguments)});d=this.getInheritanceTree(a);for(var f=0,g=d.length;f<g;f++)if("function"===typeof d[f]._inherited){d[f]._inherited(e);break}return e};c.Class.getInheritanceTree=function(a){for(var b=[],d=a.prototype;a!==Object;)b.push(a),d=Object.getPrototypeOf(d),a=d.constructor;return b};c.ENV={VERSION:"0.8.3",BROWSER:function(a){return/Eagle/.test(a)?
"eagle":/Opera/.test(a)?"opera":/MSIE|Trident/.test(a)?"ie":/Chrome/.test(a)?"chrome":/(?:Macintosh|Windows).*AppleWebKit/.test(a)?"safari":/(?:iPhone|iPad|iPod).*AppleWebKit/.test(a)?"mobilesafari":/Firefox/.test(a)?"firefox":/Android/.test(a)?"android":""}(navigator.userAgent),VENDOR_PREFIX:function(){var a=navigator.userAgent;return-1!==a.indexOf("Opera")?"O":/MSIE|Trident/.test(a)?"ms":-1!==a.indexOf("WebKit")?"webkit":"Gecko"===navigator.product?"Moz":""}(),TOUCH_ENABLED:function(){var a=document.createElement("div");
a.setAttribute("ontouchstart","return");return"function"===typeof a.ontouchstart}(),RETINA_DISPLAY:function(){if(-1!==navigator.userAgent.indexOf("iPhone")&&2===k.devicePixelRatio){var a=document.querySelector('meta[name="viewport"]');null==a&&(a=document.createElement("meta"),document.head.appendChild(a));a.setAttribute("content","width=640");return!0}return!1}(),USE_FLASH_SOUND:function(){var a=navigator.userAgent,b=navigator.vendor||"";return 0===location.href.indexOf("http")&&-1===a.indexOf("Mobile")&&
-1!==b.indexOf("Apple")}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:"putImageData drawImage drawFocusRing fill stroke clearRect fillRect strokeRect fillText strokeText".split(" "),KEY_BIND_TABLE:{37:"left",38:"up",39:"right",40:"down"},PREVENT_DEFAULT_KEY_CODES:[37,38,39,40],SOUND_ENABLED_ON_MOBILE_SAFARI:!0,USE_TOUCH_TO_START_SCENE:!0,USE_WEBAUDIO:"file:"!==location.protocol,USE_ANIMATION:!0,COLOR_DETECTION_LEVEL:2};c.Event=c.Class.create({initialize:function(a){this.type=
a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){var d=c.Core.instance;this.x=this.localX=(a-d._pageX)/d.scale;this.y=this.localY=(b-d._pageY)/d.scale}});c.Event.LOAD="load";c.Event.ERROR="error";c.Event.CORE_RESIZE="coreresize";c.Event.PROGRESS="progress";c.Event.ENTER_FRAME="enterframe";c.Event.EXIT_FRAME="exitframe";c.Event.ENTER="enter";c.Event.EXIT="exit";c.Event.CHILD_ADDED="childadded";c.Event.ADDED="added";c.Event.ADDED_TO_SCENE="addedtoscene";c.Event.CHILD_REMOVED=
"childremoved";c.Event.REMOVED="removed";c.Event.REMOVED_FROM_SCENE="removedfromscene";c.Event.TOUCH_START="touchstart";c.Event.TOUCH_MOVE="touchmove";c.Event.TOUCH_END="touchend";c.Event.RENDER="render";c.Event.INPUT_START="inputstart";c.Event.INPUT_CHANGE="inputchange";c.Event.INPUT_END="inputend";c.Event.INPUT_STATE_CHANGED="inputstatechanged";c.Event.LEFT_BUTTON_DOWN="leftbuttondown";c.Event.LEFT_BUTTON_UP="leftbuttonup";c.Event.RIGHT_BUTTON_DOWN="rightbuttondown";c.Event.RIGHT_BUTTON_UP="rightbuttonup";
c.Event.UP_BUTTON_DOWN="upbuttondown";c.Event.UP_BUTTON_UP="upbuttonup";c.Event.DOWN_BUTTON_DOWN="downbuttondown";c.Event.DOWN_BUTTON_UP="downbuttonup";c.Event.A_BUTTON_DOWN="abuttondown";c.Event.A_BUTTON_UP="abuttonup";c.Event.B_BUTTON_DOWN="bbuttondown";c.Event.B_BUTTON_UP="bbuttonup";c.Event.ADDED_TO_TIMELINE="addedtotimeline";c.Event.REMOVED_FROM_TIMELINE="removedfromtimeline";c.Event.ACTION_START="actionstart";c.Event.ACTION_END="actionend";c.Event.ACTION_TICK="actiontick";c.Event.ACTION_ADDED=
"actionadded";c.Event.ACTION_REMOVED="actionremoved";c.Event.ANIMATION_END="animationend";c.EventTarget=c.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var d=this._listeners[a];null==d?this._listeners[a]=[b]:-1===d.indexOf(b)&&d.unshift(b)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(a,b){a=this._listeners[a];null!=a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1))},clearEventListener:function(a){null!=a?delete this._listeners[a]:
this._listeners={}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(null!=this["on"+a.type])this["on"+a.type](a);var b=this._listeners[a.type];if(null!=b){b=b.slice();for(var d=0,c=b.length;d<c;d++)b[d].call(this,a)}}});(function(){var a;c.Core=c.Class.create(c.EventTarget,{initialize:function(b,d){if(null===k.document.body)throw Error("document.body is null. Please excute 'new Core()' in window.onload.");c.EventTarget.call(this);var e=!0;a&&(e=!1,
a.stop());a=c.Core.instance=this;this._soundID=this._surfaceID=this._mousedownID=this._calledTime=0;this._scenes=[];b=b||320;d=d||320;var f=document.getElementById("enchant-stage");if(f){var g=k.getComputedStyle(f);var h=parseInt(g.width,10);g=parseInt(g.height,10);for(h=h&&g?Math.min(h/b,g/d):1;f.firstChild;)f.removeChild(f.firstChild);f.style.position="relative";g=f.getBoundingClientRect();this._pageX=Math.round(k.scrollX||k.pageXOffset+g.left);this._pageY=Math.round(k.scrollY||k.pageYOffset+g.top)}else f=
document.createElement("div"),f.id="enchant-stage",f.style.position="absolute",document.body.firstChild?document.body.insertBefore(f,document.body.firstChild):document.body.appendChild(f),h=Math.min(k.innerWidth/b,k.innerHeight/d),this._pageX=f.getBoundingClientRect().left,this._pageY=f.getBoundingClientRect().top;f.style.fontSize="12px";f.style.webkitTextSizeAdjust="none";f.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)";this._element=f;this.addEventListener("coreresize",this._oncoreresize);this._width=
b;this._height=d;this.scale=h;this.fps=30;this.frame=0;this.running=this.ready=!1;this.assets={};this._assets=[];(function R(a){a.assets&&c.Core.instance.preload(a.assets);for(var b in a)a.hasOwnProperty(b)&&"object"===typeof a[b]&&null!==a[b]&&Object.getPrototypeOf(a[b])===Object.prototype&&R(a[b])})(c);this.currentScene=null;this.rootScene=new c.Scene;this.pushScene(this.rootScene);this.loadingScene=new c.LoadingScene;this._activated=!1;this._offsetY=this._offsetX=0;this.input={};this.keyboardInputManager=
new c.KeyboardInputManager(k.document,this.input);this.keyboardInputManager.addBroadcastTarget(this);this._keybind=this.keyboardInputManager._binds;c.ENV.KEY_BIND_TABLE||(c.ENV.KEY_BIND_TABLE={});for(var m in c.ENV.KEY_BIND_TABLE)this.keybind(m,c.ENV.KEY_BIND_TABLE[m]);e&&(f=c.Core.instance._element,document.addEventListener("keydown",function(b){a.dispatchEvent(new c.Event("keydown"));-1!==c.ENV.PREVENT_DEFAULT_KEY_CODES.indexOf(b.keyCode)&&(b.preventDefault(),b.stopPropagation())},!0),c.ENV.TOUCH_ENABLED&&
(f.addEventListener("touchstart",function(b){var d=b.target.tagName.toLowerCase();-1===c.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(d)&&(b.preventDefault(),a.running||b.stopPropagation())},!0),f.addEventListener("touchmove",function(b){var d=b.target.tagName.toLowerCase();-1===c.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(d)&&(b.preventDefault(),a.running||b.stopPropagation())},!0),f.addEventListener("touchend",function(b){var d=b.target.tagName.toLowerCase();-1===c.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(d)&&(b.preventDefault(),
a.running||b.stopPropagation())},!0)),f.addEventListener("mousedown",function(b){var d=b.target.tagName.toLowerCase();-1===c.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(d)&&(b.preventDefault(),a._mousedownID++,a.running||b.stopPropagation())},!0),f.addEventListener("mousemove",function(b){var d=b.target.tagName.toLowerCase();-1===c.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(d)&&(b.preventDefault(),a.running||b.stopPropagation())},!0),f.addEventListener("mouseup",function(b){var d=b.target.tagName.toLowerCase();-1===
c.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(d)&&(b.preventDefault(),a.running||b.stopPropagation())},!0),a._touchEventTarget={},c.ENV.TOUCH_ENABLED&&(f.addEventListener("touchstart",function(a){var b=c.Core.instance,d=new c.Event(c.Event.TOUCH_START);a=a.changedTouches;for(var e,f,g=0,h=a.length;g<h;g++)e=a[g],d._initPosition(e.pageX,e.pageY),f=b.currentScene._determineEventTarget(d),b._touchEventTarget[e.identifier]=f,f.dispatchEvent(d)},!1),f.addEventListener("touchmove",function(a){var b=c.Core.instance,
d=new c.Event(c.Event.TOUCH_MOVE);a=a.changedTouches;for(var e,f,g=0,h=a.length;g<h;g++)if(e=a[g],f=b._touchEventTarget[e.identifier])d._initPosition(e.pageX,e.pageY),f.dispatchEvent(d)},!1),f.addEventListener("touchend",function(a){var b=c.Core.instance,d=new c.Event(c.Event.TOUCH_END);a=a.changedTouches;for(var e,f,g=0,h=a.length;g<h;g++)if(e=a[g],f=b._touchEventTarget[e.identifier])d._initPosition(e.pageX,e.pageY),f.dispatchEvent(d),delete b._touchEventTarget[e.identifier]},!1)),f.addEventListener("mousedown",
function(a){var b=c.Core.instance,d=new c.Event(c.Event.TOUCH_START);d._initPosition(a.pageX,a.pageY);a=b.currentScene._determineEventTarget(d);b._touchEventTarget[b._mousedownID]=a;a.dispatchEvent(d)},!1),f.addEventListener("mousemove",function(a){var b=c.Core.instance,d=new c.Event(c.Event.TOUCH_MOVE);d._initPosition(a.pageX,a.pageY);(a=b._touchEventTarget[b._mousedownID])&&a.dispatchEvent(d)},!1),f.addEventListener("mouseup",function(a){var b=c.Core.instance,d=new c.Event(c.Event.TOUCH_END);d._initPosition(a.pageX,
a.pageY);(a=b._touchEventTarget[b._mousedownID])&&a.dispatchEvent(d);delete b._touchEventTarget[b._mousedownID]},!1))},width:{get:function(){return this._width},set:function(a){this._width=a;this._dispatchCoreResizeEvent()}},height:{get:function(){return this._height},set:function(a){this._height=a;this._dispatchCoreResizeEvent()}},scale:{get:function(){return this._scale},set:function(a){this._scale=a;this._dispatchCoreResizeEvent()}},_dispatchCoreResizeEvent:function(){var a=new c.Event("coreresize");
a.width=this._width;a.height=this._height;a.scale=this._scale;this.dispatchEvent(a)},_oncoreresize:function(a){this._element.style.width=Math.floor(this._width*this._scale)+"px";this._element.style.height=Math.floor(this._height*this._scale)+"px";for(var b,c=0,f=this._scenes.length;c<f;c++)b=this._scenes[c],b.dispatchEvent(a)},preload:function(a){if(!(a instanceof Array))if("object"===typeof a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push([a[c],c]);a=b}else a=Array.prototype.slice.call(arguments);
Array.prototype.push.apply(this._assets,a);return this},load:function(b,d,e,f){if("string"===typeof d){var g=d;e=e||function(){};f=f||function(){}}else{g=b;var h=e;e=d||function(){};f=h||function(){}}var m=c.Core.findExt(b);return c.Deferred.next(function(){var d=new c.Deferred,h=function(a){d.call(a);e.call(this,a)},k=function(a){d.fail(a);f.call(this,a)};if(c.Core._loadFuncs[m])c.Core.instance.assets[g]=c.Core._loadFuncs[m](b,m,h,k);else{var l=new XMLHttpRequest;l.open("GET",b,!0);l.onreadystatechange=
function(){if(4===l.readyState){if(200!==l.status&&0!==l.status){var d=new c.Event("error");d.message=l.status+": Cannot load an asset: "+b;k.call(c.Core.instance,d)}d=l.getResponseHeader("Content-Type")||"";d.match(/^image/)?a.assets[g]=c.Surface.load(b,h,k):d.match(/^audio/)?a.assets[g]=c.Sound.load(b,d,h,k):(a.assets[g]=l.responseText,h.call(c.Core.instance,new c.Event("load")))}};l.send(null)}return d})},start:function(b){var d=function(){this.frame=0;this.removeEventListener("load",d)};this.addEventListener("load",
d);this.currentTime=k.getTime();this.ready=this.running=!0;if(!this._activated&&(this._activated=!0,"mobilesafari"===c.ENV.BROWSER&&c.ENV.USE_WEBAUDIO&&c.ENV.USE_TOUCH_TO_START_SCENE)){var e=new c.Deferred,f=this._createTouchToStartScene();f.addEventListener(c.Event.TOUCH_START,function m(){this.removeEventListener(c.Event.TOUCH_START,m);var b=new c.WebAudioSound;b.buffer=c.WebAudioSound.audioContext.createBuffer(1,1,48E3);b.play();a.removeScene(f);a.start(e)},!1);a.pushScene(f);return e}this._requestNextFrame(0);
var g=this._requestPreload().next(function(){c.Core.instance.loadingScene.dispatchEvent(new c.Event(c.Event.LOAD))});b&&g.next(function(a){b.call(a)}).error(function(a){b.fail(a)});return g},_requestPreload:function(){var b={},d=0,e=0,f=function(){var b=new c.Event("progress");b.loaded=++d;b.total=e;a.loadingScene.dispatchEvent(b)};this._assets.reverse().forEach(function(a){if(a instanceof Array){var d=a[0];a=a[1]}else d=a;b[a]||(b[a]=this.load(d,a,f),e++)},this);this.pushScene(this.loadingScene);
return c.Deferred.parallel(b)},_createTouchToStartScene:function(){var b=new c.Label("Touch to Start"),d=Math.round(a.width/10),e=new c.Scene;b.color="#fff";b.font=d-1+"px bold Helvetica,Arial,sans-serif";b.textAlign="center";b.width=a.width;b.height=b._boundHeight;b.y=(a.height-b.height)/2;e.backgroundColor="#000";e.addChild(b);return e},debug:function(){this._debug=!0;return this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_requestNextFrame:function(a){this.ready&&(0>=
a?(this._calledTime=k.getTime(),k.requestAnimationFrame(this._callTick)):setTimeout(function(){var a=c.Core.instance;a._calledTime=k.getTime();k.requestAnimationFrame(a._callTick)},Math.max(0,a)))},_callTick:function(a){c.Core.instance._tick(a)},_tick:function(a){a=new c.Event("enterframe");var b=k.getTime(),e=a.elapsed=b-this.currentTime;this.currentTime=b;this._actualFps=0<e?1E3/e:0;b=this.currentScene.childNodes.slice();for(e=Array.prototype.push;b.length;){var f=b.pop();f.age++;f.dispatchEvent(a);
f.childNodes&&e.apply(b,f.childNodes)}this.currentScene.age++;this.currentScene.dispatchEvent(a);this.dispatchEvent(a);this.dispatchEvent(new c.Event("exitframe"));this.frame++;this._requestNextFrame(1E3/this.fps-(k.getTime()-this._calledTime))},getTime:function(){return k.getTime()},stop:function(){this.running=this.ready=!1},pause:function(){this.ready=!1},resume:function(){this.ready||(this.currentTime=k.getTime(),this.running=this.ready=!0,this._requestNextFrame(0))},pushScene:function(a){this._element.appendChild(a._element);
this.currentScene&&this.currentScene.dispatchEvent(new c.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new c.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene===this.rootScene)return this.currentScene;this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new c.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new c.Event("enter"));return this._scenes.pop()},replaceScene:function(a){for(var b=
this.popScene();b.firstChild;)b.removeChild(b.firstChild);return this.pushScene(a)},removeScene:function(a){if(this.currentScene===a)return this.popScene();var b=this._scenes.indexOf(a);return-1!==b?(this._scenes.splice(b,1),this._element.removeChild(a._element),a):null},_buttonListener:function(a){this.currentScene.dispatchEvent(a)},keybind:function(a,d){this.keyboardInputManager.keybind(a,d);this.addEventListener(d+"buttondown",this._buttonListener);this.addEventListener(d+"buttonup",this._buttonListener);
return this},keyunbind:function(a){var b=this._keybind[a];this.keyboardInputManager.keyunbind(a);this.removeEventListener(b+"buttondown",this._buttonListener);this.removeEventListener(b+"buttonup",this._buttonListener);return this},changeButtonState:function(a,d){this.keyboardInputManager.changeState(a,d)},getElapsedTime:function(){return this.frame/this.fps}});c.Core._loadFuncs={};c.Core._loadFuncs.jpg=c.Core._loadFuncs.jpeg=c.Core._loadFuncs.gif=c.Core._loadFuncs.png=c.Core._loadFuncs.bmp=function(a,
d,e,f){return c.Surface.load(a,e,f)};c.Core._loadFuncs.mp3=c.Core._loadFuncs.aac=c.Core._loadFuncs.m4a=c.Core._loadFuncs.wav=c.Core._loadFuncs.ogg=function(a,d,e,f){return c.Sound.load(a,"audio/"+d,e,f)};c.Core.findExt=function(a){var b=a.match(/\.\w+$/);return b&&0<b.length?b[0].slice(1).toLowerCase():0===a.indexOf("data:")?a.split(/[\/;]/)[1].toLowerCase():null};c.Core.instance=null})();c.Game=c.Core;c.InputManager=c.Class.create(c.EventTarget,{initialize:function(a,b){c.EventTarget.call(this);
this.broadcastTarget=[];this.valueStore=a;this.source=b||this;this._binds={};this._stateHandler=function(a){this.changeState(this._binds[a.source.identifier],a.data)}.bind(this)},bind:function(a,b){a.addEventListener(c.Event.INPUT_STATE_CHANGED,this._stateHandler);this._binds[a.identifier]=b},unbind:function(a){a.removeEventListener(c.Event.INPUT_STATE_CHANGED,this._stateHandler);delete this._binds[a.identifier]},addBroadcastTarget:function(a){-1===this.broadcastTarget.indexOf(a)&&this.broadcastTarget.push(a)},
removeBroadcastTarget:function(a){a=this.broadcastTarget.indexOf(a);-1!==a&&this.broadcastTarget.splice(a,1)},broadcastEvent:function(a){for(var b=this.broadcastTarget,d=0,c=b.length;d<c;d++)b[d].dispatchEvent(a)},changeState:function(a,b){}});c.InputSource=c.Class.create(c.EventTarget,{initialize:function(a){c.EventTarget.call(this);this.identifier=a},notifyStateChange:function(a){var b=new c.Event(c.Event.INPUT_STATE_CHANGED);b.data=a;b.source=this;this.dispatchEvent(b)}});c.BinaryInputManager=
c.Class.create(c.InputManager,{initialize:function(a,b,d,e){c.InputManager.call(this,a,e);this.activeInputsNum=0;this.activeEventNameSuffix=b;this.inactiveEventNameSuffix=d},bind:function(a,b){c.InputManager.prototype.bind.call(this,a,b);this.valueStore[b]=!1},unbind:function(a){var b=this._binds[a.identifier];c.InputManager.prototype.unbind.call(this,a);delete this.valueStore[b]},changeState:function(a,b){b?this._down(a):this._up(a)},_down:function(a){if(!this.valueStore[a]){this.valueStore[a]=!0;
var b=new c.Event(this.activeInputsNum++?"inputchange":"inputstart");b.source=this.source;this.broadcastEvent(b)}a=new c.Event(a+this.activeEventNameSuffix);a.source=this.source;this.broadcastEvent(a)},_up:function(a){if(this.valueStore[a]){this.valueStore[a]=!1;var b=new c.Event(--this.activeInputsNum?"inputchange":"inputend");b.source=this.source;this.broadcastEvent(b)}a=new c.Event(a+this.inactiveEventNameSuffix);a.source=this.source;this.broadcastEvent(a)}});c.BinaryInputSource=c.Class.create(c.InputSource,
{initialize:function(a){c.InputSource.call(this,a)}});c.KeyboardInputManager=c.Class.create(c.BinaryInputManager,{initialize:function(a,b){c.BinaryInputManager.call(this,b,"buttondown","buttonup");this._attachDOMEvent(a,"keydown",!0);this._attachDOMEvent(a,"keyup",!1)},keybind:function(a,b){this.bind(c.KeyboardInputSource.getByKeyCode(""+a),b)},keyunbind:function(a){this.unbind(c.KeyboardInputSource.getByKeyCode(""+a))},_attachDOMEvent:function(a,b,d){a.addEventListener(b,function(a){var b=c.Core.instance;
b&&b.running&&(a=c.KeyboardInputSource._instances[a.keyCode])&&a.notifyStateChange(d)},!0)}});c.KeyboardInputSource=c.Class.create(c.BinaryInputSource,{initialize:function(a){c.BinaryInputSource.call(this,a)}});c.KeyboardInputSource._instances={};c.KeyboardInputSource.getByKeyCode=function(a){this._instances[a]||(this._instances[a]=new c.KeyboardInputSource(a));return this._instances[a]};c.Node=c.Class.create(c.EventTarget,{initialize:function(){c.EventTarget.call(this);this._dirty=!1;this._matrix=
[1,0,0,1,0,0];this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.addEventListener("touchstart",function(a){this.parentNode&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&this.parentNode.dispatchEvent(a)});c.ENV.USE_ANIMATION&&(this.tl=new c.Timeline(this))},moveTo:function(a,b){this.x=a;this.y=b},moveBy:function(a,
b){this.x+=a;this.y+=b},x:{get:function(){return this._x},set:function(a){this._x!==a&&(this._x=a,this._dirty=!0)}},y:{get:function(){return this._y},set:function(a){this._y!==a&&(this._y=a,this._dirty=!0)}},_updateCoordinate:function(){for(var a=this,b=[a],d=a.parentNode;d&&a._dirty;)b.unshift(d),a=a.parentNode,d=a.parentNode;d=c.Matrix.instance;var e=d.stack,f=[];e.push(b[0]._matrix);for(var g=1,h=b.length;g<h;g++){a=b[g];var m=[];d.makeTransformMatrix(a,f);d.multiply(e[e.length-1],f,m);a._matrix=
m;e.push(m);var k="number"===typeof a._originX?a._originX:a._width/2||0;var P="number"===typeof a._originY?a._originY:a._height/2||0;var l=[k,P];d.multiplyVec(m,l,l);a._offsetX=l[0]-k;a._offsetY=l[1]-P;a._dirty=!1}d.reset()},remove:function(){this.parentNode&&this.parentNode.removeChild(this);if(this.childNodes)for(var a=this.childNodes.slice(),b=a.length-1;0<=b;b--)a[b].remove();this.clearEventListener()}});var l=function(a,b){for(var d=[],c,f=0,g=a.collection.length;f<g;f++)c=a.collection[f],b._intersectOne(c)&&
d.push(c);return d},q=function(a,b){for(var d=[],c,f=0,g=a.collection.length;f<g;f++)c=a.collection[f],b._intersectStrictOne(c)&&d.push(c);return d},T=function(a){if(a instanceof c.Entity)return l(this,a);if("function"===typeof a&&a.collection){for(var b=[],d,e,f=0,g=this.collection.length;f<g;f++){d=this.collection[f];for(var h=0,m=a.collection.length;h<m;h++)e=a.collection[h],d._intersectOne(e)&&b.push([d,e])}return b}return!1},U=function(a){if(a instanceof c.Entity)return q(this,a);if("function"===
typeof a&&a.collection){for(var b=[],d,e,f=0,g=this.collection.length;f<g;f++){d=this.collection[f];for(var h=0,m=a.collection.length;h<m;h++)e=a.collection[h],d._intersectStrictOne(e)&&b.push([d,e])}return b}return!1},V=c.Node.prototype.clearEventListener;c.Entity=c.Class.create(c.Node,{initialize:function(){var a=c.Core.instance;c.Node.call(this);this._rotation=0;this._scaleY=this._scaleX=1;this._touchEnabled=!0;this._clipping=!1;this._originY=this._originX=null;this._height=this._width=0;this._backgroundColor=
null;this._debugColor="#0000ff";this._opacity=1;this._visible=!0;this._buttonMode=null;this._style={};this.__styleStatus={};this._isContainedInCollection=!1;this.buttonMode=this.compositeOperation=null;this.buttonPressed=!1;this.addEventListener("touchstart",function(){this.buttonMode&&(this.buttonPressed=!0,this.dispatchEvent(new c.Event(this.buttonMode+"buttondown")),a.changeButtonState(this.buttonMode,!0))});this.addEventListener("touchend",function(){this.buttonMode&&(this.buttonPressed=!1,this.dispatchEvent(new c.Event(this.buttonMode+
"buttonup")),a.changeButtonState(this.buttonMode,!1))});this.enableCollection()},width:{get:function(){return this._width},set:function(a){this._width!==a&&(this._width=a,this._dirty=!0)}},height:{get:function(){return this._height},set:function(a){this._height!==a&&(this._height=a,this._dirty=!0)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a}},debugColor:{get:function(){return this._debugColor},set:function(a){this._debugColor=a}},opacity:{get:function(){return this._opacity},
set:function(a){this._opacity=parseFloat(a)}},visible:{get:function(){return this._visible},set:function(a){this._visible=a}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){this._touchEnabled=a;this._style.pointerEvents=a?"all":"none"}},intersect:function(a){return a instanceof c.Entity?this._intersectOne(a):"function"===typeof a&&a.collection?l(a,this):!1},_intersectOne:function(a){this._dirty&&this._updateCoordinate();a._dirty&&a._updateCoordinate();return this._offsetX<
a._offsetX+a.width&&a._offsetX<this._offsetX+this.width&&this._offsetY<a._offsetY+a.height&&a._offsetY<this._offsetY+this.height},intersectStrict:function(a){return a instanceof c.Entity?this._intersectStrictOne(a):"function"===typeof a&&a.collection?q(a,this):!1},_intersectStrictOne:function(a){this._dirty&&this._updateCoordinate();a._dirty&&a._updateCoordinate();var b=this.getOrientedBoundingRect();a=a.getOrientedBoundingRect();var d=b.leftTop,c=b.rightTop,f=b.leftBottom,g=b.rightBottom,h=a.leftTop,
m=a.rightTop,k=a.leftBottom,l=a.rightBottom,n=d[0],p=d[1],x=c[0],B=c[1],C=f[0],y=f[1],v=g[0],D=g[1],E=h[0],t=h[1],q=m[0],G=m[1],H=k[0],I=k[1],J=l[0],K=l[1],r=[x-n,B-p],u=[v-x,D-B],z=[C-v,y-D],A=[n-C,p-y];a=[q-E,G-t];b=[J-q,K-G];var F=[H-J,I-K],w=[E-H,t-I],L=n+x+C+v>>2,M=p+B+y+D>>2,N=E+q+H+J>>2,O=t+G+I+K>>2;if(0<r[0]*(O-p)-r[1]*(N-n)&&0<u[0]*(O-B)-u[1]*(N-x)&&0<z[0]*(O-D)-z[1]*(N-v)&&0<A[0]*(O-y)-A[1]*(N-C)||0<a[0]*(M-t)-a[1]*(L-E)&&0<b[0]*(M-G)-b[1]*(L-q)&&0<F[0]*(M-K)-F[1]*(L-J)&&0<w[0]*(M-I)-w[1]*
(L-H))return!0;d=[d,c,g,f];c=[h,m,l,k];f=[r,u,z,A];b=[a,b,F,w];for(a=0;4>a;a++)for(w=d[a],F=w[0],w=w[1],m=f[a],h=m[0],k=m[1],m=0;4>m;m++)if(r=c[m],A=r[0],g=r[1],u=b[m],r=u[0],u=u[1],z=h*u-k*r,0!==z&&(A-=F,l=g-w,g=(A*k-l*h)/z,r=(A*u-l*r)/z,0<g&&1>g&&0<r&&1>r))return!0;return!1},within:function(a,b){this._dirty&&this._updateCoordinate();a._dirty&&a._updateCoordinate();null==b&&(b=(this.width+this.height+a.width+a.height)/4);var d;return(d=this._offsetX-a._offsetX+(this.width-a.width)/2)*d+(d=this._offsetY-
a._offsetY+(this.height-a.height)/2)*d<b*b},scale:function(a,b){this._scaleX*=a;this._scaleY*=null!=b?b:a;this._dirty=!0},rotate:function(a){this.rotation+=a},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX!==a&&(this._scaleX=a,this._dirty=!0)}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY!==a&&(this._scaleY=a,this._dirty=!0)}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation!==a&&(this._rotation=a,this._dirty=!0)}},
originX:{get:function(){return this._originX},set:function(a){this._originX!==a&&(this._originX=a,this._dirty=!0)}},originY:{get:function(){return this._originY},set:function(a){this._originY!==a&&(this._originY=a,this._dirty=!0)}},enableCollection:function(){this.addEventListener("addedtoscene",this._addSelfToCollection);this.addEventListener("removedfromscene",this._removeSelfFromCollection);this.scene&&this._addSelfToCollection()},disableCollection:function(){this.removeEventListener("addedtoscene",
this._addSelfToCollection);this.removeEventListener("removedfromscene",this._removeSelfFromCollection);this.scene&&this._removeSelfFromCollection()},clearEventListener:function(){V.apply(this,arguments);this.scene&&this._removeSelfFromCollection()},_addSelfToCollection:function(){this._isContainedInCollection||(this.getConstructor()._collectionTarget.forEach(function(a){a.collection.push(this)},this),this._isContainedInCollection=!0)},_removeSelfFromCollection:function(){this._isContainedInCollection&&
(this.getConstructor()._collectionTarget.forEach(function(a){var b=a.collection.indexOf(this);-1!==b&&a.collection.splice(b,1)},this),this._isContainedInCollection=!1)},getBoundingRect:function(){var a=this.width||0,b=this.height||0,d=this._matrix,c=d[0]*a;a*=d[1];var f=d[2]*b;b*=d[3];var g=d[4];d=d[5];c=[g,c+g,f+g,c+f+g].sort(function(a,b){return a-b});a=[d,a+d,b+d,a+b+d].sort(function(a,b){return a-b});return{left:c[0],top:a[0],width:c[3]-c[0],height:a[3]-a[0]}},getOrientedBoundingRect:function(){var a=
this.width||0,b=this.height||0,d=this._matrix,c=d[0]*a;a*=d[1];var f=d[2]*b;b*=d[3];var g=d[4];d=d[5];return{leftTop:[g,d],rightTop:[c+g,a+d],leftBottom:[f+g,b+d],rightBottom:[c+f+g,a+b+d]}},getConstructor:function(){return Object.getPrototypeOf(this).constructor}});var Q=function(a){if(!a._collective){var b=c.Class.getInheritanceTree(a),d=b.indexOf(c.Entity);a._collectionTarget=-1!==d?b.splice(0,d+1):[];a.intersect=T;a.intersectStrict=U;a.collection=[];a._collective=!0}};Q(c.Entity);c.Entity._inherited=
function(a){Q(a)};c.Sprite=c.Class.create(c.Entity,{initialize:function(a,b){c.Entity.call(this);this.width=a;this.height=b;this._image=null;this._debugColor="#ff0000";this._frame=this._frameTop=this._frameLeft=0;this._frameSequence=null},image:{get:function(){return this._image},set:function(a){if(a===n)throw Error("Assigned value on Sprite.image is undefined. Please double-check image path, and check if the image you want to use is preload before use.");a!==this._image&&(this._image=a,this._computeFramePosition())}},
frame:{get:function(){return this._frame},set:function(a){null==this._frameSequence&&this._frame===a||this._deepCompareToPreviousFrame(a)||(a instanceof Array?this._frameSequence=a:(this._frameSequence=null,this._frame=a,this._computeFramePosition()))}},_frameSequence:{get:function(){return this.__frameSequence},set:function(a){a&&!this.__frameSequence?this.addEventListener(c.Event.ENTER_FRAME,this._rotateFrameSequence):!a&&this.__frameSequence&&this.removeEventListener(c.Event.ENTER_FRAME,this._rotateFrameSequence);
a?(this.__frameSequence=a.slice(),this._originalFrameSequence=a.slice(),this._rotateFrameSequence()):this._originalFrameSequence=this.__frameSequence=null}},_deepCompareToPreviousFrame:function(a){if(a===this._originalFrameSequence)return!0;if(null==a||null==this._originalFrameSequence||!(a instanceof Array)||a.length!==this._originalFrameSequence.length)return!1;for(var b=0;b<a.length;++b)if(a[b]!==this._originalFrameSequence[b])return!1;return!0},_computeFramePosition:function(){var a=this._image;
if(null!=a){var b=a.width/this._width|0;this._frameLeft=(this._frame%b|0)*this._width;this._frameTop=(this._frame/b|0)*this._height%a.height}},_rotateFrameSequence:function(){var a=this._frameSequence;if(a&&0!==a.length){var b=a.shift();null===b?(this._frameSequence=null,this.dispatchEvent(new c.Event(c.Event.ANIMATION_END))):(this._frame=b,this._computeFramePosition(),a.push(b))}},width:{get:function(){return this._width},set:function(a){this._width=a;this._computeFramePosition();this._dirty=!0}},
height:{get:function(){return this._height},set:function(a){this._height=a;this._computeFramePosition();this._dirty=!0}},cvsRender:function(a){var b=this._image,d=this._width,e=this._height;if(b&&0!==d&&0!==e){var f=b.width;var g=b.height;if(f<d||g<e)a.fillStyle=c.Surface._getPattern(b),a.fillRect(0,0,d,e);else{b=b._element;var h=this._frameLeft;var m=Math.min(this._frameTop,g-e);f=Math.max(.01,Math.min(f-h,d));g=Math.max(.01,Math.min(g-m,e));a.drawImage(b,h,m,f,g,0,0,d,e)}}},domRender:function(){return function(a){this._image&&
this._image._css&&(this._style["background-image"]=this._image._css,this._style["background-position"]=-this._frameLeft+"px "+-this._frameTop+"px")}}()});c.Label=c.Class.create(c.Entity,{initialize:function(a){c.Entity.call(this);this.text=a||"";this.width=300;this.font="14px serif";this.textAlign="left";this.borderWidth=0;this.borderColor="white";this._debugColor="#ff0000"},width:{get:function(){return this._width},set:function(a){this._width=a;this._dirty=!0;this.updateBoundArea()}},text:{get:function(){return this._text},
set:function(a){a=""+a;if(this._text!==a){this._text=a;a=a.replace(/<br ?\/?>/gi,"<br/>");this._splitText=a.split("<br/>");this.updateBoundArea();for(var b=0,d=this._splitText.length;b<d;b++){a=this._splitText[b];var c=this.getMetrics(a);this._splitText[b]={};this._splitText[b].text=a;this._splitText[b].height=c.height;this._splitText[b].width=c.width}}}},textAlign:{get:function(){return this._style["text-align"]},set:function(a){this._style["text-align"]=a;this.updateBoundArea()}},font:{get:function(){return this._style.font},
set:function(a){this._style.font=a;this.updateBoundArea()}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}},borderWidth:{get:function(){return this._border_width},set:function(a){this._border_width=a}},borderColor:{get:function(){return this._border_color},set:function(a){this._border_color=a}},cvsRender:function(a){var b=0,d=this.width,c,f;if(this._splitText){a.textBaseline="top";a.font=this.font;a.fillStyle=this.color||"#000000";var g=a.measureText(" ").width;
g=d/g;for(var h=0,m=this._splitText.length;h<m;h++){var k=this._splitText[h];var l=k.text;for(c=0;l.length>c+g||a.measureText(l.slice(c,c+g)).width>d;){var n="";var p=g;for(f=0;0<p;)f=a.measureText(n).width<d?f+p:f-p,n=l.slice(c,c+f),p=p/2|0;a.fillText(n,0,b);b+=k.height-1;c+=f}n=l.slice(c,c+l.length);l="right"===this.textAlign?d-a.measureText(n).width:"center"===this.textAlign?(d-a.measureText(n).width)/2:0;0<this.borderWidth&&(a.lineWidth=this.borderWidth,a.strokeStyle=this.borderColor,a.strokeText(n,
l,b));a.fillText(n,l,b);b+=k.height-1}}},domRender:function(a){a.innerHTML!==this._text&&(a.innerHTML=this._text)},detectRender:function(a){a.fillRect(this._boundOffset,0,this._boundWidth,this._boundHeight)},updateBoundArea:function(){var a=this.getMetrics();this._boundWidth=a.width;this._boundHeight=a.height;this._boundOffset="right"===this.textAlign?this.width-this._boundWidth:"center"===this.textAlign?(this.width-this._boundWidth)/2:0},getMetrics:function(a){var b={};if(document.body){var d=document.createElement("div");
for(var c in this._style)"width"!==c&&"height"!==c&&(d.style[c]=this._style[c]);a=a||this._text;d.innerHTML=a.replace(/ /g,"&nbsp;");d.style.whiteSpace="noWrap";d.style.lineHeight=1;document.body.appendChild(d);a=getComputedStyle(d);b.height=parseInt(a.height,10)+1;d.style.position="absolute";b.width=parseInt(a.width,10)+1;document.body.removeChild(d)}else b.width=this.width,b.height=this.height;return b}});c.Map=c.Class.create(c.Entity,{initialize:function(a,b){var d=c.Core.instance;c.Entity.call(this);
var e=new c.Surface(d.width,d.height);this._surface=e;e=e._element;e.style.position="absolute";c.ENV.RETINA_DISPLAY&&2===d.scale?(e.width=2*d.width,e.height=2*d.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(e.width=d.width,e.height=d.height);this._context=e.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this.touchEnabled=this._tight=this._dirty=!1;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",
function(){this._dirty&&(this._previousOffsetX=this._previousOffsetY=null)})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);this._dirty=!0;this._tight=!1;for(var b=0,d=this._data.length;b<d;b++){var c=0;a=this._data[b];for(var f=0,g=a.length;f<g;f++)for(var h=0,m=a[f].length;h<m;h++)0<=a[f][h]&&c++;if(.2<c/(a.length*a[0].length)){this._tight=!0;break}}},checkTile:function(a,b){if(0>a||this.width<=a||0>b||this.height<=b)return!1;var d=this._image.width,c=this._image.height;
return this._data[0][b/(this._tileHeight||c)|0][a/(this._tileWidth||d)|0]},hitTest:function(a,b){if(0>a||this.width<=a||0>b||this.height<=b)return!1;var d=this._image.width,c=this._image.height,f=this._tileWidth||d,g=this._tileHeight||c;a=a/f|0;b=b/g|0;if(null!=this.collisionData)return this.collisionData[b]&&!!this.collisionData[b][a];for(var h=0,m=this._data.length;h<m;h++){var k=this._data[h],l;if(null!=k[b]&&null!=(l=k[b][a])&&0<=l&&l<(d/f|0)*(c/g|0))return!0}return!1},image:{get:function(){return this._image},
set:function(a){var b=c.Core.instance;this._image=a;if(c.ENV.RETINA_DISPLAY&&2===b.scale){b=new c.Surface(2*a.width,2*a.height);for(var d=this._tileWidth||a.width,e=this._tileHeight||a.height,f=a.width/d|0,g=a.height/e|0,h=0;h<g;h++)for(var m=0;m<f;m++)b.draw(a,m*d,h*e,d,e,m*d*2,h*e*2,2*d,2*e);this._doubledImage=b}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth!==a&&(this._tileWidth=a,this._dirty=!0)}},tileHeight:{get:function(){return this._tileHeight},
set:function(a){this._tileHeight!==a&&(this._tileHeight=a,this._dirty=!0)}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,d,c){if(null!=this._image){if(this._doubledImage){var e=this._doubledImage;var g=2*this._tileWidth;var h=2*this._tileHeight;var m=2*-this._offsetX;var k=2*-this._offsetY;a*=2;b*=2;d*=2;c*=2}else e=this._image,g=this._tileWidth,h=this._tileHeight,m=-this._offsetX,k=
-this._offsetY;var l=e.width/g|0,n=e.height/h|0,p=Math.max((a+m)/g|0,0),q=Math.max((b+k)/h|0,0),B=Math.ceil((a+m+d)/g),C=Math.ceil((b+k+c)/h);e=e._element;var y=this._context;y.clearRect(a,b,d,c);d=0;for(c=this._data.length;d<c;d++){var v=this._data[d],D=Math.min(B,v[0].length),E=Math.min(C,v.length);for(b=q;b<E;b++)for(a=p;a<D;a++){var t=v[b][a];0<=t&&t<l*n&&y.drawImage(e,t%l*g,(t/l|0)*h,g,h,a*g-m,b*h-k,g,h)}}}},updateBuffer:function(){if(this._visible===n||this._visible){var a=c.Core.instance;if(this._dirty||
null==this._previousOffsetX)this.redraw(0,0,a.width,a.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var b=-this._offsetX,d=-this._offsetY,e=-this._previousOffsetX,f=-this._previousOffsetY,g=b-e+a.width,h=e-b+a.width,m=d-f+a.height,k=f-d+a.height;if(g>this._tileWidth&&h>this._tileWidth&&m>this._tileHeight&&k>this._tileHeight){if(g<h){var l=0;b=e-b;h=g}else l=b-e,b=0;m<k?(g=0,d=f-d):(g=d-f,d=0,m=k);null==a._buffer&&(a._buffer=document.createElement("canvas"),
a._buffer.width=this._context.canvas.width,a._buffer.height=this._context.canvas.height);k=a._buffer.getContext("2d");this._doubledImage?(k.clearRect(0,0,2*h,2*m),k.drawImage(this._context.canvas,2*l,2*g,2*h,2*m,0,0,2*h,2*m),k=this._context,k.clearRect(2*b,2*d,2*h,2*m),k.drawImage(a._buffer,0,0,2*h,2*m,2*b,2*d,2*h,2*m)):(k.clearRect(0,0,h,m),k.drawImage(this._context.canvas,l,g,h,m,0,0,h,m),k=this._context,k.clearRect(b,d,h,m),k.drawImage(a._buffer,0,0,h,m,b,d,h,m));0===b?this.redraw(h,0,a.width-
h,a.height):this.redraw(0,0,a.width-h,a.height);0===d?this.redraw(0,m,a.width,a.height-m):this.redraw(0,0,a.width,a.height-m)}else this.redraw(0,0,a.width,a.height)}else this.redraw(0,0,a.width,a.height);this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY}},cvsRender:function(a){if(0!==this.width&&0!==this.height){var b=c.Core.instance;this.updateBuffer();a.save();a.setTransform(1,0,0,1,0,0);a.drawImage(this._context.canvas,0,0,b.width,b.height);a.restore()}},domRender:function(a){this._image&&
(this.updateBuffer(),this._style["background-image"]=this._surface._css,this._style[c.ENV.VENDOR_PREFIX+"Transform"]="matrix(1, 0, 0, 1, 0, 0)")}});c.Group=c.Class.create(c.Node,{initialize:function(){this.childNodes=[];c.Node.call(this);this._rotation=0;this._scaleY=this._scaleX=1;this._originY=this._originX=null;this.__dirty=!1;[c.Event.ADDED_TO_SCENE,c.Event.REMOVED_FROM_SCENE].forEach(function(a){this.addEventListener(a,function(a){this.childNodes.forEach(function(b){b.scene=this.scene;b.dispatchEvent(a)},
this)})},this)},addChild:function(a){a.parentNode&&a.parentNode.removeChild(a);this.childNodes.push(a);a.parentNode=this;var b=new c.Event("childadded");b.node=a;b.next=null;this.dispatchEvent(b);a.dispatchEvent(new c.Event("added"));this.scene&&(a.scene=this.scene,b=new c.Event("addedtoscene"),a.dispatchEvent(b))},insertBefore:function(a,b){a.parentNode&&a.parentNode.removeChild(a);var d=this.childNodes.indexOf(b);-1!==d?(this.childNodes.splice(d,0,a),a.parentNode=this,d=new c.Event("childadded"),
d.node=a,d.next=b,this.dispatchEvent(d),a.dispatchEvent(new c.Event("added")),this.scene&&(a.scene=this.scene,b=new c.Event("addedtoscene"),a.dispatchEvent(b))):this.addChild(a)},removeChild:function(a){var b;-1!==(b=this.childNodes.indexOf(a))&&(this.childNodes.splice(b,1),a.parentNode=null,b=new c.Event("childremoved"),b.node=a,this.dispatchEvent(b),a.dispatchEvent(new c.Event("removed")),this.scene&&(a.scene=null,b=new c.Event("removedfromscene"),a.dispatchEvent(b)))},firstChild:{get:function(){return this.childNodes[0]}},
lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation!==a&&(this._rotation=a,this._dirty=!0)}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX!==a&&(this._scaleX=a,this._dirty=!0)}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY!==a&&(this._scaleY=a,this._dirty=!0)}},originX:{get:function(){return this._originX},set:function(a){this._originX!==a&&
(this._originX=a,this._dirty=!0)}},originY:{get:function(){return this._originY},set:function(a){this._originY!==a&&(this._originY=a,this._dirty=!0)}},_dirty:{get:function(){return this.__dirty},set:function(a){if(this.__dirty=a=!!a){a=0;for(var b=this.childNodes.length;a<b;a++)this.childNodes[a]._dirty=!0}}}});c.Matrix=c.Class.create({initialize:function(){this.reset()},reset:function(){this.stack=[];this.stack.push([1,0,0,1,0,0])},makeTransformMatrix:function(a,b){var d=a._x,c=a._y,f=a.width||0,
g=a.height||0,h="number"===typeof a._scaleX?a._scaleX:1,k="number"===typeof a._scaleY?a._scaleY:1,l=(a._rotation||0)*Math.PI/180,n=Math.cos(l);l=Math.sin(l);f="number"===typeof a._originX?a._originX:f/2;a="number"===typeof a._originY?a._originY:g/2;g=h*n;h*=l;l*=k;k*=n;b[0]=g;b[1]=h;b[2]=-l;b[3]=k;b[4]=-g*f+l*a+d+f;b[5]=-h*f-k*a+c+a},multiply:function(a,b,d){var c=a[0],f=a[2],g=a[4],h=a[1],k=a[3];a=a[5];var l=b[0],n=b[2],q=b[4],p=b[1],x=b[3];b=b[5];d[0]=c*l+f*p;d[1]=h*l+k*p;d[2]=c*n+f*x;d[3]=h*n+
k*x;d[4]=c*q+f*b+g;d[5]=h*q+k*b+a},multiplyVec:function(a,b,d){var c=b[0];b=b[1];var f=a[1],g=a[3],h=a[5];d[0]=a[0]*c+a[2]*b+a[4];d[1]=f*c+g*b+h}});c.Matrix.instance=new c.Matrix;c.DetectColorManager=c.Class.create({initialize:function(a,b){this.reference=[];this.colorResolution=a||16;this.max=b||1;this.capacity=Math.pow(this.colorResolution,3);a=1;for(b=this.capacity;a<b;a++)this.reference[a]=null},attachDetectColor:function(a){var b=this.reference.indexOf(null);-1===b&&(b=1);this.reference[b]=a;
return this._getColor(b)},detachDetectColor:function(a){a=this.reference.indexOf(a);-1!==a&&(this.reference[a]=null)},_getColor:function(a){var b=this.colorResolution,d=b/this.max;return[parseInt(a/b/b%b,10)/d,parseInt(a/b%b,10)/d,parseInt(a%b,10)/d,1]},_decodeDetectColor:function(a,b){b=b||0;var d=this.colorResolution;return~~(a[b]*d*d*d/256)+~~(a[b+1]*d*d/256)+~~(a[b+2]*d/256)},getSpriteByColor:function(a){return this.reference[this._decodeDetectColor(a)]},getSpriteByColors:function(a){var b,d=
0,c={};var f=0;for(b=a.length;f<b;f+=4){var g=this._decodeDetectColor(a,f);c[g]=(c[g]||0)+1}for(g in c)if(c[g]>d){d=c[g];var h=g}return this.reference[h]}});c.DomManager=c.Class.create({initialize:function(a,b){var d=c.Core.instance;this.layer=null;this.targetNode=a;"string"===typeof b?this.element=document.createElement(b):b instanceof HTMLElement&&(this.element=b);this.style=this.element.style;this.style.position="absolute";this.style[c.ENV.VENDOR_PREFIX+"TransformOrigin"]="0px 0px";d._debug&&(this.style.border=
"1px solid blue",this.style.margin="-1px");var e=this;this._setDomTarget=function(){e.layer._touchEventTarget=e.targetNode};this._attachEvent()},getDomElement:function(){return this.element},getDomElementAsNext:function(){return this.element},getNextManager:function(a){a=this.targetNode.parentNode.childNodes.indexOf(a.targetNode);return a!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[a+1]._domManager:null},addManager:function(a,b){var d;b&&(d=b.getDomElementAsNext());
a=a.getDomElement();a instanceof Array?a.forEach(function(a){d?this.element.insertBefore(a,d):this.element.appendChild(a)},this):d?this.element.insertBefore(a,d):this.element.appendChild(a);this.setLayer(this.layer)},removeManager:function(a){a instanceof c.DomlessManager?a._domRef.forEach(function(a){this.element.removeChild(a)},this):this.element.removeChild(a.element);this.setLayer(this.layer)},setLayer:function(a){this.layer=a;var b=this.targetNode,d;if(b.childNodes)for(var c=0,f=b.childNodes.length;c<
f;c++)(d=b.childNodes[c]._domManager)&&d.setLayer(a)},render:function(a){var b=this.targetNode,d=c.Matrix.instance,e=d.stack,f=[];d.makeTransformMatrix(b,f);d.multiply(e[e.length-1],f,f);d.multiply(a,f,a);b._matrix=a;a="number"===typeof b._originX?b._originX:b.width/2||0;e="number"===typeof b._originY?b._originY:b.height/2||0;var g=[a,e];d.multiplyVec(f,g,g);b._offsetX=g[0]-a;b._offsetY=g[1]-e;!b.parentNode||b.parentNode instanceof c.Group||(b._offsetX+=b.parentNode._offsetX,b._offsetY+=b.parentNode._offsetY);
b._dirty&&(this.style[c.ENV.VENDOR_PREFIX+"Transform"]="matrix("+f[0].toFixed(10)+","+f[1].toFixed(10)+","+f[2].toFixed(10)+","+f[3].toFixed(10)+","+f[4].toFixed(10)+","+f[5].toFixed(10)+")");this.domRender()},domRender:function(){var a=this.targetNode;a._style||(a._style={});a.__styleStatus||(a.__styleStatus={});null!==a.width&&(a._style.width=a.width+"px");null!==a.height&&(a._style.height=a.height+"px");a._style.opacity=a._opacity;a._style["background-color"]=a._backgroundColor;"undefined"!==typeof a._visible&&
(a._style.display=a._visible?"block":"none");"function"===typeof a.domRender&&a.domRender(this.element);var b;for(b in a._style){var d=a._style[b];a.__styleStatus[b]!==d&&null!=d&&(this.style.setProperty(b,""+d),a.__styleStatus[b]=d)}},_attachEvent:function(){c.ENV.TOUCH_ENABLED&&this.element.addEventListener("touchstart",this._setDomTarget,!0);this.element.addEventListener("mousedown",this._setDomTarget,!0)},_detachEvent:function(){c.ENV.TOUCH_ENABLED&&this.element.removeEventListener("touchstart",
this._setDomTarget,!0);this.element.removeEventListener("mousedown",this._setDomTarget,!0)},remove:function(){this._detachEvent();this.element=this.style=this.targetNode=null}});c.DomlessManager=c.Class.create({initialize:function(a){this._domRef=[];this.targetNode=a},_register:function(a,b){b=this._domRef.indexOf(b);a instanceof Array?-1===b?Array.prototype.push.apply(this._domRef,a):Array.prototype.splice.apply(this._domRef,[b,0].concat(a)):-1===b?this._domRef.push(a):this._domRef.splice(b,0,a)},
getNextManager:function(a){a=this.targetNode.parentNode.childNodes.indexOf(a.targetNode);return a!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[a+1]._domManager:null},getDomElement:function(){var a=[];this.targetNode.childNodes.forEach(function(b){a=a.concat(b._domManager.getDomElement())});return a},getDomElementAsNext:function(){if(this._domRef.length)return this._domRef[0];var a=this.getNextManager(this);return a?a.element:null},addManager:function(a,b){var d=
this.targetNode.parentNode;d&&(null===b&&(b=this.getNextManager(this)),d instanceof c.Scene?d._layers.Dom._domManager.addManager(a,b):d._domManager.addManager(a,b));b=b?b.getDomElementAsNext():null;this._register(a.getDomElement(),b);this.setLayer(this.layer)},removeManager:function(a){var b=this._domRef.indexOf(a.element);-1!==b&&(a=this._domRef[b],a.parentNode.removeChild(a),this._domRef.splice(b,1));this.setLayer(this.layer)},setLayer:function(a){this.layer=a;var b=this.targetNode,d;if(b.childNodes)for(var c=
0,f=b.childNodes.length;c<f;c++)(d=b.childNodes[c]._domManager)&&d.setLayer(a)},render:function(a){var b=c.Matrix.instance,d=b.stack,e=this.targetNode,f=[];b.makeTransformMatrix(e,f);b.multiply(d[d.length-1],f,f);b.multiply(a,f,a);e._matrix=a;a="number"===typeof e._originX?e._originX:e.width/2||0;var g="number"===typeof e._originY?e._originY:e.height/2||0,h=[a,g];b.multiplyVec(f,h,h);e._offsetX=h[0]-a;e._offsetY=h[1]-g;d.push(f)},remove:function(){this._domRef=[];this.targetNode=null}});c.DomLayer=
c.Class.create(c.Group,{initialize:function(){var a=c.Core.instance;c.Group.call(this);this._touchEventTarget=null;this._element=document.createElement("div");this._element.style.position="absolute";this._domManager=new c.DomManager(this,this._element);this._domManager.layer=this;this.width=a.width;this.height=a.height;[c.Event.TOUCH_START,c.Event.TOUCH_MOVE,c.Event.TOUCH_END].forEach(function(a){this.addEventListener(a,function(a){this._scene&&this._scene.dispatchEvent(a)})},this);var b=function(a){var e=
a.node,g=a.next;a=a.target;g=g?g._domManager:null;c.DomLayer._attachDomManager(e,b,d);a._domManager.addManager(e._domManager,g);g=new c.Event(c.Event.RENDER);e._dirty=!0;a._domManager.layer._rendering(e,g)},d=function(a){var e=a.node;a.target._domManager.removeManager(e._domManager);c.DomLayer._detachDomManager(e,b,d)};this.addEventListener("childremoved",d);this.addEventListener("childadded",b)},width:{get:function(){return this._width},set:function(a){this._width=a;this._element.style.width=a+"px"}},
height:{get:function(){return this._height},set:function(a){this._height=a;this._element.style.height=a+"px"}},addChild:function(a){this.childNodes.push(a);a.parentNode=this;var b=new c.Event("childadded");b.node=a;b.next=null;this.dispatchEvent(b);a.dispatchEvent(new c.Event("added"));this.scene&&(a.scene=this.scene,b=new c.Event("addedtoscene"),a.dispatchEvent(b))},insertBefore:function(a,b){var d=this.childNodes.indexOf(b);-1!==d?(this.childNodes.splice(d,0,a),a.parentNode=this,d=new c.Event("childadded"),
d.node=a,d.next=b,this.dispatchEvent(d),a.dispatchEvent(new c.Event("added")),this.scene&&(a.scene=this.scene,b=new c.Event("addedtoscene"),a.dispatchEvent(b))):this.addChild(a)},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe);this._onexitframe()},_stopRendering:function(){this.removeEventListener("exitframe",this._onexitframe);this._onexitframe()},_onexitframe:function(){this._rendering(this,new c.Event(c.Event.RENDER))},_rendering:function(a,b,d){d||(d=[1,0,0,1,0,
0]);a.dispatchEvent(b);a._domManager.render(d);if(a.childNodes)for(var e=0,f=a.childNodes.length;e<f;e++){var g=a.childNodes[e];this._rendering(g,b,d.slice())}a._domManager instanceof c.DomlessManager&&c.Matrix.instance.stack.pop();a._dirty=!1},_determineEventTarget:function(){var a=this._touchEventTarget;this._touchEventTarget=null;return a===this?null:a}});c.DomLayer._attachDomManager=function(a,b,d){a._domManager||(a.addEventListener("childadded",b),a.addEventListener("childremoved",d),a._domManager=
a instanceof c.Group?new c.DomlessManager(a):a._element?new c.DomManager(a,a._element):new c.DomManager(a,"div"));if(a.childNodes)for(var e=0,f=a.childNodes.length;e<f;e++){var g=a.childNodes[e];c.DomLayer._attachDomManager(g,b,d);a._domManager.addManager(g._domManager,null)}};c.DomLayer._detachDomManager=function(a,b,d){a.removeEventListener("childadded",b);a.removeEventListener("childremoved",d);if(a.childNodes)for(var e=0,f=a.childNodes.length;e<f;e++){var g=a.childNodes[e];a._domManager.removeManager(g._domManager,
null);c.DomLayer._detachDomManager(g,b,d)}a._domManager.remove();delete a._domManager};c.CanvasLayer=c.Class.create(c.Group,{initialize:function(){var a=c.Core.instance;c.Group.call(this);this._cvsCache={matrix:[1,0,0,1,0,0],detectColor:"#000000"};this._cvsCache.layer=this;this._element=document.createElement("canvas");this._element.style.position="absolute";this._element.style.left=this._element.style.top="0px";this._detect=document.createElement("canvas");this._detect.style.position="absolute";
this._lastDetected=0;this.context=this._element.getContext("2d");this._dctx=this._detect.getContext("2d");this._setImageSmoothingEnable();this._colorManager=new c.DetectColorManager(16,256);this.width=a.width;this.height=a.height;[c.Event.TOUCH_START,c.Event.TOUCH_MOVE,c.Event.TOUCH_END].forEach(function(a){this.addEventListener(a,function(a){this._scene&&this._scene.dispatchEvent(a)})},this);var b=function(a){var e=a.node;a=a.target;var g=a instanceof c.CanvasLayer?a._scene._layers.Canvas:a.scene._layers.Canvas;
c.CanvasLayer._attachCache(e,g,b,d);var h=new c.Event(c.Event.RENDER);a._dirty&&a._updateCoordinate();e._dirty=!0;c.Matrix.instance.stack.push(a._matrix);c.CanvasRenderer.instance.render(g.context,e,h);c.Matrix.instance.stack.pop(a._matrix)},d=function(a){var e=a.target;c.CanvasLayer._detachCache(a.node,e instanceof c.CanvasLayer?e._scene._layers.Canvas:e.scene._layers.Canvas,b,d)};this.addEventListener("childremoved",d);this.addEventListener("childadded",b)},width:{get:function(){return this._width},
set:function(a){this._width=a;this._element.width=this._detect.width=a;this._setImageSmoothingEnable()}},height:{get:function(){return this._height},set:function(a){this._height=a;this._element.height=this._detect.height=a;this._setImageSmoothingEnable()}},addChild:function(a){this.childNodes.push(a);a.parentNode=this;var b=new c.Event("childadded");b.node=a;b.next=null;this.dispatchEvent(b);a.dispatchEvent(new c.Event("added"))},insertBefore:function(a,b){var d=this.childNodes.indexOf(b);-1!==d?
(this.childNodes.splice(d,0,a),a.parentNode=this,d=new c.Event("childadded"),d.node=a,d.next=b,this.dispatchEvent(d),a.dispatchEvent(new c.Event("added"))):this.addChild(a)},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe);this._onexitframe()},_stopRendering:function(){this.removeEventListener("exitframe",this._onexitframe);this._onexitframe()},_onexitframe:function(){var a=c.Core.instance,b=this.context;b.clearRect(0,0,a.width,a.height);a=new c.Event(c.Event.RENDER);
c.CanvasRenderer.instance.render(b,this,a)},_determineEventTarget:function(a){return this._getEntityByPosition(a.x,a.y)},_getEntityByPosition:function(a,b){var d=c.Core.instance,e=this._dctx;this._lastDetected<d.frame&&(e.clearRect(0,0,this.width,this.height),c.CanvasRenderer.instance.detectRender(e,this),this._lastDetected=d.frame);d=c.ENV.COLOR_DETECTION_LEVEL-1;a=e.getImageData(a-d,b-d,1+2*d,1+2*d).data;return this._colorManager.getSpriteByColors(a)},_setImageSmoothingEnable:function(){this._dctx.imageSmoothingEnabled=
this._dctx.msImageSmoothingEnabled=this._dctx.mozImageSmoothingEnabled=this._dctx.webkitImageSmoothingEnabled=!1}});c.CanvasLayer._attachCache=function(a,b,d,e){a._cvsCache||(a._cvsCache={},a._cvsCache.matrix=[1,0,0,1,0,0],a._cvsCache.detectColor="rgba("+b._colorManager.attachDetectColor(a)+")",a.addEventListener("childadded",d),a.addEventListener("childremoved",e));if(a.childNodes)for(var f=0,g=a.childNodes.length;f<g;f++){var h=a.childNodes[f];c.CanvasLayer._attachCache(h,b,d,e)}};c.CanvasLayer._detachCache=
function(a,b,d,e){a._cvsCache&&(b._colorManager.detachDetectColor(a),a.removeEventListener("childadded",d),a.removeEventListener("childremoved",e),delete a._cvsCache);if(a.childNodes)for(var f=0,g=a.childNodes.length;f<g;f++){var h=a.childNodes[f];c.CanvasLayer._detachCache(h,b,d,e)}};c.CanvasRenderer=c.Class.create({render:function(a,b,d){a.save();b.dispatchEvent(d);this.transform(a,b);if("undefined"===typeof b._visible||b._visible){var e=b.width;var f=b.height;b.compositeOperation&&(a.globalCompositeOperation=
b.compositeOperation);a.globalAlpha="number"===typeof b._opacity?b._opacity:1;b._backgroundColor&&(a.fillStyle=b._backgroundColor,a.fillRect(0,0,e,f));b.cvsRender&&b.cvsRender(a);c.Core.instance._debug&&b._debugColor&&(a.strokeStyle=b._debugColor,a.strokeRect(0,0,e,f));b._clipping&&(a.beginPath(),a.rect(0,0,e,f),a.clip());if(b.childNodes){f=0;for(var g=b.childNodes.length;f<g;f++)e=b.childNodes[f],this.render(a,e,d)}}a.restore();c.Matrix.instance.stack.pop()},detectRender:function(a,b){if("undefined"===
typeof b._visible||b._visible){var d=b.width;var e=b.height;a.save();this.transform(a,b);a.fillStyle=b._cvsCache.detectColor;b._touchEnabled&&(b.detectRender?b.detectRender(a):a.fillRect(0,0,d,e));b._clipping&&(a.beginPath(),a.rect(0,0,d,e),a.clip());if(b.childNodes){e=0;for(var f=b.childNodes.length;e<f;e++)d=b.childNodes[e],this.detectRender(a,d)}a.restore();c.Matrix.instance.stack.pop()}},transform:function(a,b){var d=c.Matrix.instance,e=d.stack;if(b._dirty){d.makeTransformMatrix(b,b._cvsCache.matrix);
var f=[];d.multiply(e[e.length-1],b._cvsCache.matrix,f);b._matrix=f;var g="number"===typeof b._originX?b._originX:b._width/2||0;var h="number"===typeof b._originY?b._originY:b._height/2||0;var k=[g,h];d.multiplyVec(f,k,k);b._offsetX=k[0]-g;b._offsetY=k[1]-h;b._dirty=!1}else f=b._matrix;e.push(f);a.setTransform.apply(a,f)}});c.CanvasRenderer.instance=new c.CanvasRenderer;c.Scene=c.Class.create(c.Group,{initialize:function(){var a=c.Core.instance;c.Group.call(this);this.scene=this;this._backgroundColor=
null;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style[c.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0";this._layers={};this._layerPriority=[];this.addEventListener(c.Event.CHILD_ADDED,this._onchildadded);this.addEventListener(c.Event.CHILD_REMOVED,this._onchildremoved);this.addEventListener(c.Event.ENTER,this._onenter);this.addEventListener(c.Event.EXIT,this._onexit);var b=this;this._dispatchExitframe=function(){var a;
for(a in b._layers){var e=b._layers[a];e.dispatchEvent(new c.Event(c.Event.EXIT_FRAME))}};this.addEventListener(c.Event.CORE_RESIZE,this._oncoreresize);this._oncoreresize(a)},x:{get:function(){return this._x},set:function(a){this._x=a;for(var b in this._layers)this._layers[b].x=a}},y:{get:function(){return this._y},set:function(a){this._y=a;for(var b in this._layers)this._layers[b].y=a}},width:{get:function(){return this._width},set:function(a){this._width=a;for(var b in this._layers)this._layers[b].width=
a}},height:{get:function(){return this._height},set:function(a){this._height=a;for(var b in this._layers)this._layers[b].height=a}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;for(var b in this._layers)this._layers[b].rotation=a}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;for(var b in this._layers)this._layers[b].scaleX=a}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;for(var b in this._layers)this._layers[b].scaleY=
a}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=this._element.style.backgroundColor=a}},remove:function(){for(this.clearEventListener();0<this.childNodes.length;)this.childNodes[0].remove();return c.Core.instance.removeScene(this)},_oncoreresize:function(a){this._element.style.width=a.width+"px";this.width=a.width;this._element.style.height=a.height+"px";this.height=a.height;this._element.style[c.ENV.VENDOR_PREFIX+"Transform"]="scale("+a.scale+
")";for(var b in this._layers)this._layers[b].dispatchEvent(a)},addLayer:function(a,b){var d=c.Core.instance;if(!this._layers[a]){var e=new c[a+"Layer"];d.currentScene===this&&e._startRendering();this._layers[a]=e;d=e._element;if("number"===typeof b){var f=this._element.childNodes[b];f?this._element.insertBefore(d,f):this._element.appendChild(d);this._layerPriority.splice(b,0,a)}else this._element.appendChild(d),this._layerPriority.push(a);e._scene=this}},_determineEventTarget:function(a){for(var b,
c=this._layerPriority.length-1;0<=c&&!(b=this._layers[this._layerPriority[c]],b=b._determineEventTarget(a));c--);b||(b=this);return b},_onchildadded:function(a){var b=a.node;a=a.next;if(b._element){var c="Dom";var e=1}else c="Canvas",e=0;this._layers[c]||this.addLayer(c,e);b._layer=this._layers[c];this._layers[c].insertBefore(b,a);b.parentNode=this},_onchildremoved:function(a){a=a.node;a._layer.removeChild(a);a._layer=null},_onenter:function(){for(var a in this._layers)this._layers[a]._startRendering();
c.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){for(var a in this._layers)this._layers[a]._stopRendering();c.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}});c.LoadingScene=c.Class.create(c.Scene,{initialize:function(){c.Scene.call(this);this.backgroundColor="#000";var a=.4*this.width|0,b=.05*this.width|0,d=.03*a|0,e=new c.Sprite(a,b);e.disableCollection();e.x=(this.width-a)/2;e.y=(this.height-b)/2;var f=new c.Surface(a,b);f.context.fillStyle=
"#fff";f.context.fillRect(0,0,a,b);f.context.fillStyle="#000";f.context.fillRect(d,d,a-2*d,b-2*d);e.image=f;var g=0;this.addEventListener("progress",function(a){g=a.loaded/a.total});e.addEventListener("enterframe",function(){f.context.fillStyle="#fff";f.context.fillRect(d,0,(a-2*d)*g,b)});this.addChild(e);var h=new Label("");h.width=this.width;h.font=Math.floor(this.width/24)+"px arial black";h.color="white";h.textAlign="center";h.moveTo((this.width-h.width)/2,e.y-h._boundHeight);this.loaded_func=
null;this.addEventListener("load",function(a){this.loaded_func=function(){var b=c.Core.instance;b.removeScene(b.loadingScene);b.dispatchEvent(a)};h.text=(null===k.ontouchstart?"\u30bf\u30c3\u30d7":"\u30af\u30ea\u30c3\u30af")+"\u3057\u3066\u30b9\u30bf\u30fc\u30c8\uff01<br>\uff08\u97f3\u304c\u51fa\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\uff09";this.removeChild(e);this.addChild(h)});this.addEventListener("touchend",function(a){this.loaded_func&&this.loaded_func()})}});c.CanvasScene=
c.Class.create(c.Scene,{initialize:function(){c.Scene.call(this);this.addLayer("Canvas")},_determineEventTarget:function(a){(a=this._layers.Canvas._determineEventTarget(a))||(a=this);return a},_onchildadded:function(a){var b=a.node;a=a.next;b._layer=this._layers.Canvas;this._layers.Canvas.insertBefore(b,a)},_onenter:function(){this._layers.Canvas._startRendering();c.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Canvas._stopRendering();c.Core.instance.removeEventListener("exitframe",
this._dispatchExitframe)}});c.DOMScene=c.Class.create(c.Scene,{initialize:function(){c.Scene.call(this);this.addLayer("Dom")},_determineEventTarget:function(a){(a=this._layers.Dom._determineEventTarget(a))||(a=this);return a},_onchildadded:function(a){var b=a.node;a=a.next;b._layer=this._layers.Dom;this._layers.Dom.insertBefore(b,a)},_onenter:function(){this._layers.Dom._startRendering();c.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Dom._stopRendering();
c.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}});c.Surface=c.Class.create(c.EventTarget,{initialize:function(a,b){c.EventTarget.call(this);var d=c.Core.instance;this.width=Math.ceil(a);this.height=Math.ceil(b);this.context=null;d="enchant-surface"+d._surfaceID++;document.getCSSCanvasContext?(this.context=document.getCSSCanvasContext("2d",d,a,b),this._element=this.context.canvas,this._css="-webkit-canvas("+d+")"):document.mozSetImageElement?(this._element=document.createElement("canvas"),
this._element.width=a,this._element.height=b,this._css="-moz-element(#"+d+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(d,this._element)):(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._element.style.position="absolute",this.context=this._element.getContext("2d"),c.ENV.CANVAS_DRAWING_METHODS.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=!0}},this))},getPixel:function(a,
b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,c,e,f,g){var d=this.context.createImageData(1,1);d.data[0]=c;d.data[1]=e;d.data[2]=f;d.data[3]=g;this.context.putImageData(d,a,b)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){a=a._element;if(1===arguments.length)this.context.drawImage(a,0,0);else{var b=arguments;b[0]=a;this.context.drawImage.apply(this.context,b)}},clone:function(){var a=new c.Surface(this.width,this.height);a.draw(this);
return a},toDataURL:function(){var a=this._element.src;return a?"data:"===a.slice(0,5)?a:this.clone().toDataURL():this._element.toDataURL()}});c.Surface.load=function(a,b,d){var e=new Image,f=Object.create(c.Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:e}});c.EventTarget.call(f);d=d||function(){};f.addEventListener("load",b);f.addEventListener("error",d);e.onerror=function(){var a=new c.Event(c.Event.ERROR);a.message="Cannot load an asset: "+e.src;c.Core.instance.dispatchEvent(a);
f.dispatchEvent(a)};e.onload=function(){f.width=e.width;f.height=e.height;f.dispatchEvent(new c.Event("load"))};e.src=a;return f};c.Surface._staticCanvas2DContext=document.createElement("canvas").getContext("2d");c.Surface._getPattern=function(a,b){if(!a._pattern||b)a._pattern=this._staticCanvas2DContext.createPattern(a._element,"repeat");return a._pattern};k.Deferred?c.Deferred=k.Deferred:(c.Deferred=c.Class.create({initialize:function(){this._succ=this._fail=this._next=this._id=null;this._tail=
this},next:function(a){var b=new c.Deferred;b._succ=a;return this._add(b)},error:function(a){var b=new c.Deferred;b._fail=a;return this._add(b)},_add:function(a){this._tail=this._tail._next=a;return this},call:function(a){for(var b,d=this;d&&!d._succ;)d=d._next;if(d instanceof c.Deferred){try{b=d._succ(a)}catch(e){return d.fail(e)}b instanceof c.Deferred?c.Deferred._insert(d,b):d._next instanceof c.Deferred&&d._next.call(b)}},fail:function(a){var b;for(b=this;b&&!b._fail;)b=b._next;if(b instanceof
c.Deferred)a=b._fail(a),b.call(a);else{if(a instanceof Error)throw a;b=Error("failed in Deferred");b.arg=a;throw b;}}}),c.Deferred._insert=function(a,b){a._next instanceof c.Deferred&&(b._tail._next=a._next);a._next=b},c.Deferred.next=function(a){var b=(new c.Deferred).next(a);b._id=setTimeout(function(){b.call()},0);return b},c.Deferred.parallel=function(a){var b=new c.Deferred;b._id=setTimeout(function(){b.call()},0);var d=0,e=a instanceof Array?[]:{},f=new c.Deferred,g;for(g in a)a.hasOwnProperty(g)&&
(d++,function(a,b){a.next(function(a){d--;e[b]=a;0>=d&&f.call(e)}).error(function(a){f.fail(a)});"number"===typeof a._id&&clearTimeout(a._id);a._id=setTimeout(function(){a.call()},0)}(a[g],g));d||(f._id=setTimeout(function(){f.call(e)},0));return b.next(function(){return f})});c.DOMSound=c.Class.create(c.EventTarget,{initialize:function(){c.EventTarget.call(this);this.duration=0;throw Error("Illegal Constructor");},play:function(){this._element&&this._element.play()},pause:function(){this._element&&
this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){if(this._element instanceof Audio)var a=Object.create(c.DOMSound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(c.ENV.USE_FLASH_SOUND)return this;a=Object.create(c.DOMSound.prototype)}c.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){this._element&&(this._element.currentTime=a)}},volume:{get:function(){return this._element?
this._element.volume:1},set:function(a){this._element&&(this._element.volume=a)}}});c.DOMSound.load=function(a,b,d,e){null==b&&(b=(b=c.Core.findExt(a))?"audio/"+b:"");b=b.replace("mp3","mpeg").replace("m4a","mp4");d=d||function(){};e=e||function(){};var f=Object.create(c.DOMSound.prototype);c.EventTarget.call(f);f.addEventListener("load",d);f.addEventListener("error",e);var g=new Audio;if(!c.ENV.SOUND_ENABLED_ON_MOBILE_SAFARI&&"webkit"===c.ENV.VENDOR_PREFIX&&c.ENV.TOUCH_ENABLED)k.setTimeout(function(){f.dispatchEvent(new c.Event("load"))},
0);else if(!c.ENV.USE_FLASH_SOUND&&g.canPlayType(b))g.addEventListener("canplaythrough",function S(){f.duration=g.duration;f.dispatchEvent(new c.Event("load"));g.removeEventListener("canplaythrough",S)},!1),g.src=a,g.load(),g.autoplay=!1,g.onerror=function(){var a=new c.Event(c.Event.ERROR);a.message="Cannot load an asset: "+g.src;c.Core.instance.dispatchEvent(a);f.dispatchEvent(a)},f._element=g;else if("audio/mpeg"===b){var h=document.createElement("embed");d="enchant-audio"+c.Core.instance._soundID++;
h.width=h.height=1;h.name=d;h.src="sound.swf?id="+d+"&src="+a;h.allowscriptaccess="always";h.style.position="absolute";h.style.left="-1px";f.addEventListener("load",function(){Object.defineProperties(h,{currentTime:{get:function(){return h.getCurrentTime()},set:function(a){h.setCurrentTime(a)}},volume:{get:function(){return h.getVolume()},set:function(a){h.setVolume(a)}}});f._element=h;f.duration=h.getDuration()});c.Core.instance._element.appendChild(h);c.DOMSound[d]=f}else k.setTimeout(function(){f.dispatchEvent(new c.Event("load"))},
0);return f};k.AudioContext=k.AudioContext||k.webkitAudioContext||k.mozAudioContext||k.msAudioContext||k.oAudioContext;c.WebAudioSound=c.Class.create(c.EventTarget,{initialize:function(){if(!k.AudioContext)throw Error("This browser does not support WebAudio API.");c.EventTarget.call(this);c.WebAudioSound.audioContext||(c.WebAudioSound.audioContext=new k.AudioContext,c.WebAudioSound.destination=c.WebAudioSound.audioContext.destination);this.context=c.WebAudioSound.audioContext;this.src=this.context.createBufferSource();
this.buffer=null;this._volume=1;this._state=this._currentTime=0;this.connectTarget=c.WebAudioSound.destination},play:function(a){1!==this._state||a||this.src.disconnect();2!==this._state&&(this._currentTime=0);a=this._currentTime;var b=this.context;this.src=b.createBufferSource();this._gain=null!=b.createGain?b.createGain():b.createGainNode();this.src.buffer=this.buffer;this._gain.gain.value=this._volume;this.src.connect(this._gain);this._gain.connect(this.connectTarget);null!=this.src.start?this.src.start(0,
a,this.buffer.duration-a-1.192E-7):this.src.noteGrainOn(0,a,this.buffer.duration-a-1.192E-7);this._startTime=b.currentTime-this._currentTime;this._state=1},pause:function(){var a=this.currentTime;a!==this.duration&&(null!=this.src.stop?this.src.stop(0):this.src.noteOff(0),this._currentTime=a,this._state=2)},stop:function(){null!=this.src.stop?this.src.stop(0):this.src.noteOff(0);this._state=0},clone:function(){var a=new c.WebAudioSound;a.buffer=this.buffer;return a},duration:{get:function(){return this.buffer?
this.buffer.duration:0}},volume:{get:function(){return this._volume},set:function(a){this._volume=a=Math.max(0,Math.min(1,a));this.src&&(this._gain.gain.value=a)}},currentTime:{get:function(){return Math.max(0,Math.min(this.duration,this.src.context.currentTime-this._startTime))},set:function(a){this._currentTime=a;2!==this._state&&this.play(!1)}}});c.WebAudioSound.load=function(a,b,d,e){function f(){var b=new c.Event(c.Event.ERROR);b.message="Cannot load an asset: "+a;c.Core.instance.dispatchEvent(b);
g.dispatchEvent(b)}b=(new Audio).canPlayType(b);var g=new c.WebAudioSound;e=e||function(){};g.addEventListener(c.Event.LOAD,d||function(){});g.addEventListener(c.Event.ERROR,e);if("maybe"===b||"probably"===b){var h=c.WebAudioSound.audioContext;var k=new XMLHttpRequest;k.open("GET",a,!0);k.responseType="arraybuffer";k.onload=function(){h.decodeAudioData(k.response,function(a){g.buffer=a;g.dispatchEvent(new c.Event(c.Event.LOAD))},f)};k.onerror=f;k.send(null)}else setTimeout(f,50);return g};c.Sound=
k.AudioContext&&c.ENV.USE_WEBAUDIO?c.WebAudioSound:c.DOMSound;c.Easing={LINEAR:function(a,b,c,e){return c*a/e+b},SWING:function(a,b,c,e){return c*(.5-Math.cos(a/e*Math.PI)/2)+b},QUAD_EASEIN:function(a,b,c,e){return c*(a/=e)*a+b},QUAD_EASEOUT:function(a,b,c,e){return-c*(a/=e)*(a-2)+b},QUAD_EASEINOUT:function(a,b,c,e){return 1>(a/=e/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CUBIC_EASEIN:function(a,b,c,e){return c*(a/=e)*a*a+b},CUBIC_EASEOUT:function(a,b,c,e){return c*((a=a/e-1)*a*a+1)+b},CUBIC_EASEINOUT:function(a,
b,c,e){return 1>(a/=e/2)?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},QUART_EASEIN:function(a,b,c,e){return c*(a/=e)*a*a*a+b},QUART_EASEOUT:function(a,b,c,e){return-c*((a=a/e-1)*a*a*a-1)+b},QUART_EASEINOUT:function(a,b,c,e){return 1>(a/=e/2)?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},QUINT_EASEIN:function(a,b,c,e){return c*(a/=e)*a*a*a*a+b},QUINT_EASEOUT:function(a,b,c,e){return c*((a=a/e-1)*a*a*a*a+1)+b},QUINT_EASEINOUT:function(a,b,c,e){return 1>(a/=e/2)?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},SIN_EASEIN:function(a,
b,c,e){return-c*Math.cos(a/e*(Math.PI/2))+c+b},SIN_EASEOUT:function(a,b,c,e){return c*Math.sin(a/e*(Math.PI/2))+b},SIN_EASEINOUT:function(a,b,c,e){return-c/2*(Math.cos(Math.PI*a/e)-1)+b},CIRC_EASEIN:function(a,b,c,e){return-c*(Math.sqrt(1-(a/=e)*a)-1)+b},CIRC_EASEOUT:function(a,b,c,e){return c*Math.sqrt(1-(a=a/e-1)*a)+b},CIRC_EASEINOUT:function(a,b,c,e){return 1>(a/=e/2)?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},ELASTIC_EASEIN:function(a,b,c,e,f,g){if(0===a)return b;if(1===(a/=
e))return b+c;g||(g=.3*e);!f||f<Math.abs(c)?(f=c,c=g/4):c=g/(2*Math.PI)*Math.asin(c/f);return-(f*Math.pow(2,10*--a)*Math.sin(2*(a*e-c)*Math.PI/g))+b},ELASTIC_EASEOUT:function(a,b,c,e,f,g){if(0===a)return b;if(1===(a/=e))return b+c;g||(g=.3*e);if(!f||f<Math.abs(c)){f=c;var d=g/4}else d=g/(2*Math.PI)*Math.asin(c/f);return f*Math.pow(2,-10*a)*Math.sin(2*(a*e-d)*Math.PI/g)+c+b},ELASTIC_EASEINOUT:function(a,b,c,e,f,g){if(0===a)return b;if(2===(a/=e/2))return b+c;g||(g=.3*e*1.5);if(!f||f<Math.abs(c)){f=
c;var d=g/4}else d=g/(2*Math.PI)*Math.asin(c/f);return 1>a?-.5*f*Math.pow(2,10*--a)*Math.sin(2*(a*e-d)*Math.PI/g)+b:f*Math.pow(2,-10*--a)*Math.sin(2*(a*e-d)*Math.PI/g)*.5+c+b},BOUNCE_EASEOUT:function(a,b,c,e){return(a/=e)<1/2.75?7.5625*c*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BOUNCE_EASEIN:function(a,b,d,e){return d-c.Easing.BOUNCE_EASEOUT(e-a,0,d,e)+b},BOUNCE_EASEINOUT:function(a,b,d,e){return a<e/2?.5*
c.Easing.BOUNCE_EASEIN(2*a,0,d,e)+b:.5*c.Easing.BOUNCE_EASEOUT(2*a-e,0,d,e)+.5*d+b},BACK_EASEIN:function(a,b,c,e,f){f===n&&(f=1.70158);return c*(a/=e)*a*((f+1)*a-f)+b},BACK_EASEOUT:function(a,b,c,e,f){f===n&&(f=1.70158);return c*((a=a/e-1)*a*((f+1)*a+f)+1)+b},BACK_EASEINOUT:function(a,b,c,e,f){f===n&&(f=1.70158);return 1>(a/=e/2)?c/2*a*a*(((f*=1.525)+1)*a-f)+b:c/2*((a-=2)*a*(((f*=1.525)+1)*a+f)+2)+b},EXPO_EASEIN:function(a,b,c,e){return 0===a?b:c*Math.pow(2,10*(a/e-1))+b},EXPO_EASEOUT:function(a,
b,c,e){return a===e?b+c:c*(-Math.pow(2,-10*a/e)+1)+b},EXPO_EASEINOUT:function(a,b,c,e){return 0===a?b:a===e?b+c:1>(a/=e/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b}};c.ActionEventTarget=c.Class.create(c.EventTarget,{initialize:function(){c.EventTarget.apply(this,arguments)},dispatchEvent:function(a){var b=this.node?this.node:this;a.target=b;a.localX=a.x-b._offsetX;a.localY=a.y-b._offsetY;null!=this["on"+a.type]&&this["on"+a.type].call(b,a);var c=this._listeners[a.type];if(null!=c){c=
c.slice();for(var e=0,f=c.length;e<f;e++)c[e].call(b,a)}}});c.Timeline=c.Class.create(c.EventTarget,{initialize:function(a){c.EventTarget.call(this);this.node=a;this.queue=[];this.looped=this.paused=!1;this.isFrameBased=!0;this._parallel=null;this._activated=!1;this.addEventListener(c.Event.ENTER_FRAME,this._onenterframe);var b=this;this._nodeEventListener=function(a){b.dispatchEvent(a)}},_deactivateTimeline:function(){this._activated&&(this._activated=!1,this.node.removeEventListener("enterframe",
this._nodeEventListener))},_activateTimeline:function(){this._activated||this.paused||(this.node.addEventListener("enterframe",this._nodeEventListener),this._activated=!0)},_onenterframe:function(a){this.paused||this.tick(this.isFrameBased?1:a.elapsed)},setFrameBased:function(){this.isFrameBased=!0},setTimeBased:function(){this.isFrameBased=!1},next:function(a){var b=this.queue.shift();if(b){var d=new c.Event("actionend");d.timeline=this;b.dispatchEvent(d);d=new c.Event("removedfromtimeline");d.timeline=
this;b.dispatchEvent(d);this.looped&&this.add(b)}if(0===this.queue.length)this._deactivateTimeline();else if(0<a||this.queue[0]&&0===this.queue[0].time)d=new c.Event("actiontick"),d.elapsed=a,d.timeline=this,this.queue[0].dispatchEvent(d)},tick:function(a){if(0<this.queue.length){var b=this.queue[0];if(0===b.frame){var d=new c.Event("actionstart");d.timeline=this;b.dispatchEvent(d)}d=new c.Event("actiontick");d.timeline=this;d.elapsed=a;b.dispatchEvent(d)}},add:function(a){this._activateTimeline();
this._parallel?(this._parallel.actions.push(a),this._parallel=null):this.queue.push(a);a.frame=0;var b=new c.Event("addedtotimeline");b.timeline=this;a.dispatchEvent(b);b=new c.Event("actionadded");b.action=a;this.dispatchEvent(b);return this},action:function(a){return this.add(new c.Action(a))},tween:function(a){return this.add(new c.Tween(a))},clear:function(){var a=new c.Event("removedfromtimeline");a.timeline=this;for(var b=0,d=this.queue.length;b<d;b++)this.queue[b].dispatchEvent(a);this.queue=
[];this._deactivateTimeline();return this},skip:function(a){var b=new c.Event("enterframe");this.isFrameBased?b.elapsed=1:(b.elapsed=a,a=1);for(;a--;)this.dispatchEvent(b);return this},pause:function(){this.paused||(this.paused=!0,this._deactivateTimeline());return this},resume:function(){this.paused&&(this.paused=!1,this._activateTimeline());return this},loop:function(){this.looped=!0;return this},unloop:function(){this.looped=!1;return this},delay:function(a){return this.action({time:a})},wait:function(a){return this},
then:function(a){return this.action({onactiontick:function(b){a.call(this)},time:0})},exec:function(a){return this.then(a)},cue:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(this.delay(c-b),this.then(a[c]),b=c);return this},repeat:function(a,b){return this.action({onactiontick:function(b){a.call(this)},time:b})},and:function(){var a=this.queue.pop();if(a instanceof c.ParallelAction)this._parallel=a,this.queue.push(a);else{var b=new c.ParallelAction;b.actions.push(a);this.queue.push(b);this._parallel=
b}return this},or:function(){return this},doAll:function(a){return this},waitAll:function(){return this},waitUntil:function(a){return this.action({onactiontick:function(b){a.call(this)&&b.timeline.next()}})},fadeTo:function(a,b,c){return this.tween({opacity:a,time:b,easing:c})},fadeIn:function(a,b){return this.fadeTo(1,a,b)},fadeOut:function(a,b){return this.fadeTo(0,a,b)},moveTo:function(a,b,c,e){return this.tween({x:a,y:b,time:c,easing:e})},moveX:function(a,b,c){return this.tween({x:a,time:b,easing:c})},
moveY:function(a,b,c){return this.tween({y:a,time:b,easing:c})},moveBy:function(a,b,c,e){return this.tween({x:function(){return this.x+a},y:function(){return this.y+b},time:c,easing:e})},hide:function(){return this.then(function(){this.opacity=0})},show:function(){return this.then(function(){this.opacity=1})},removeFromScene:function(){return this.then(function(){this.parentNode.removeChild(this)})},scaleTo:function(a,b,c,e){if("number"===typeof c){var d=b;b=c;c=e}else a=d=a;return this.tween({scaleX:a,
scaleY:d,time:b,easing:c})},scaleBy:function(a,b,c,e){if("number"===typeof c){var d=a;var g=b;b=c;c=e}else d=g=a;return this.tween({scaleX:function(){return this.scaleX*d},scaleY:function(){return this.scaleY*g},time:b,easing:c})},rotateTo:function(a,b,c){return this.tween({rotation:a,time:b,easing:c})},rotateBy:function(a,b,c){return this.tween({rotation:function(){return this.rotation+a},time:b,easing:c})}});c.Action=c.Class.create(c.ActionEventTarget,{initialize:function(a){c.ActionEventTarget.call(this);
this.time=null;this.frame=0;for(var b in a)a.hasOwnProperty(b)&&null!=a[b]&&(this[b]=a[b]);var d=this;this.node=this.timeline=null;this.addEventListener(c.Event.ADDED_TO_TIMELINE,function(a){d.timeline=a.timeline;d.node=a.timeline.node;d.frame=0});this.addEventListener(c.Event.REMOVED_FROM_TIMELINE,function(){d.timeline=null;d.node=null;d.frame=0});this.addEventListener(c.Event.ACTION_TICK,function(a){var b=d.time-(d.frame+a.elapsed);null!=d.time&&0>=b?(d.frame=d.time,a.timeline.next(-b)):d.frame+=
a.elapsed})}});c.ParallelAction=c.Class.create(c.Action,{initialize:function(a){c.Action.call(this,a);this.actions=[];this.endedActions=[];var b=this;this.addEventListener(c.Event.ACTION_START,function(a){for(var c=0,d=b.actions.length;c<d;c++)b.actions[c].dispatchEvent(a)});this.addEventListener(c.Event.ACTION_TICK,function(a){var d,f=new c.Event("actiontick");f.timeline={next:function(a){a=b.actions[g];b.actions.splice(g--,1);d=b.actions.length;b.endedActions.push(a);var e=new c.Event("actionend");
e.timeline=this;a.dispatchEvent(e);e=new c.Event("removedfromtimeline");e.timeline=this;a.dispatchEvent(e)}};f.elapsed=a.elapsed;var g=0;for(d=b.actions.length;g<d;g++)b.actions[g].dispatchEvent(f);0===b.actions.length&&a.timeline.next()});this.addEventListener(c.Event.ADDED_TO_TIMELINE,function(a){for(var c=0,d=b.actions.length;c<d;c++)b.actions[c].dispatchEvent(a)});this.addEventListener(c.Event.REMOVED_FROM_TIMELINE,function(){b.actions=b.endedActions;b.endedActions=[]})}});c.Tween=c.Class.create(c.Action,
{initialize:function(a){var b={},d={};c.Action.call(this,a);null==this.easing&&(this.easing=c.Easing.LINEAR);var e=this;this.addEventListener(c.Event.ACTION_START,function(){var c="frame time callback onactiontick onactionstart onactionend".split(" "),g;for(g in a)if(a.hasOwnProperty(g)){var h="function"===typeof a[g]?a[g].call(e.node):a[g];-1===c.indexOf(g)&&(b[g]=e.node[g],d[g]=h)}});this.addEventListener(c.Event.ACTION_TICK,function(a){a=0===e.time?1:e.easing(Math.min(e.time,e.frame+a.elapsed),
0,1,e.time)-e.easing(e.frame,0,1,e.time);for(var c in d)d.hasOwnProperty(c)&&"undefined"!==typeof this[c]&&(e.node[c]+=(d[c]-b[c])*a,1E-7>Math.abs(e.node[c])&&(e.node[c]=0))})}})})(window);enchant.ui={};var UI_FONT_FAM="'\u30d2\u30e9\u30ae\u30ce\u89d2\u30b4\u30b7\u30c3\u30af','Hiragino Sans','\u30e1\u30a4\u30ea\u30aa', Meiryo, sans-serif-monospace, sans-serif";
enchant.ui.Button2=enchant.Class.create(enchant.Entity,{initialize:function(k,n,c){enchant.Entity.call(this);enchant.CanvasLayer&&(this._element="div");this.width=n||null;this.height=c||null;this._text=k;this.pressed=!1;var l=this._style;k=Math.min(c/2,(n-20)/(k.length+2));l.width=n+"px";l.height=c+"px";l.display="table-cell";l["font-family"]=UI_FONT_FAM;l["font-size"]=k+"px";l["font-weight"]="bold";l.cursor="pointer";l["text-align"]="center";l["vertical-align"]="middle";l["line-height"]=c+"px";l["text-decoration"]=
"none";l.background="#ffbe6b";l.color="#FFF";l["text-shadow"]="-1px -1px 0 rgba(0,0,0,0.2)";l["border-radius"]="10px";l["box-shadow"]="inset 0 3px 0 rgba(255,255,255,0.2), inset 0 -3px 0 rgba(0, 0, 0, 0.05)";l.border="solid 2px #d27d00";l["box-sizing"]="border-box";this.addEventListener("touchstart",function(){l["box-shadow"]="0 0 2px rgba(0, 0, 0, 0.30)";this.pressed=!0});this.addEventListener("touchend",function(){l["box-shadow"]="inset 0 3px 0 rgba(255,255,255,0.2), inset 0 -3px 0 rgba(0, 0, 0, 0.05)";
this.pressed=!1})},cvsRender:function(){},domRender:function(){this._domManager.element.innerHTML=this._text}});
enchant.ui.ButtonVanishBugFix=enchant.Class.create(enchant.Entity,{initialize:function(k){enchant.Entity.call(this);enchant.CanvasLayer&&(this._element="div");this.height=this.width=null;this._text="";this.pressed=!1;var n=this._style;n.width="0px";n.height="0px";n.border="solid 1px rgba(0,0,0,0)";this.moveTo(0,0);k.addChild(this)},cvsRender:function(){},domRender:function(){this._domManager.element.innerHTML=this._text}});
enchant.ui.LabelButton=enchant.Class.create(enchant.Group,{initialize:function(k,n,c,l,q){enchant.Group.call(this);this.width=n;this.height=c;this.action=q;this.font_size=l||Math.min(c/2,(n-20)/(k.length+2));this.button=new Sprite(n,c);this.button.backgroundColor="#ffbe6b";this.addChild(this.button);this.shadow_shift=1;n=.9887*(this.height-this.font_size)/2+.5763;this.slabel=new Label(k);this.slabel.font="bold "+this.font_size+"px "+UI_FONT_FAM;this.slabel.text=k;this.slabel.width=this.width;this.slabel.height=
this.height;this.slabel.x=this.centerX(k)+this.shadow_shift;this.slabel.y=n+this.shadow_shift;this.slabel.color="#faa83e";this.addChild(this.slabel);this.label=new Label(k);this.label.font=this.slabel.font;this.label.text=k;this.label.width=this.width;this.label.height=this.height;this.label.x=this.centerX(k);this.label.y=n;this.label.color="#fff";this.addChild(this.label);this.show()},centerX:function(k){return this.button.width/2-k.length*this.font_size/2},setText:function(k){this.label.x=this.centerX(k);
this.label.text=k;this.slabel.x=this.centerX(k)+this.shadow_shift;this.slabel.text=k},show:function(){this.button.visible=!0;this.label.visible=!0;this.slabel.visible=!0},hide:function(){this.button.visible=!1;this.label.visible=!1;this.slabel.visible=!1},push:function(){this.button.backgroundColor="#ffeab3"},release:function(){this.button.backgroundColor="#ffbe6b"},ontouchstart:function(){this.push()},ontouchend:function(){this.release();this.action()}});
